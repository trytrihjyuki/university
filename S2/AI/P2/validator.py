#!/usr/bin/env python
# -*- coding: UTF-8 -*-
'''
Prosta sprawdzarka. Przykłady użycia:

1. Uruchomienie wszystkich testów dla danego zadania:
  `python validator.py zad1 python rozwiazanie.py`

2. Uruchomienie wybranych testów
  `python validator.py --cases 1,3-5 zad1 a.out`

3. Urochomienie na innych testach
  `python validator.py --testset large_tests.yaml zad1 python rozwiazanie.py`

4. Wypisanie przykładowego wejścia/wyjścia:
  `python validator.py --show_example zad1`

5. Wypisanie informacji o rozwiązaniu:
  `python validator.py --verbose zad1 python rozwiazanie.py`

6. Wymuszenie użycia STDIN/STDOUT do komunikacji:
  `python validator.py --stdio zad1 python rozwiazanie.py`

7. Ustawienie mnożnika dla limitów czasowych:
  `python validator.py --timeout-multiplier 2.5 zad1 python rozwiazanie.py`


'''

from __future__ import absolute_import
from __future__ import print_function
from __future__ import unicode_literals

import argparse
import os
import signal
import subprocess
import sys
import threading
import time
import math
import timeit

import numpy as np

import yaml

VERBOSE = False

# Tests embedded into the validator.
DEFAULT_TESTSET_YAML = (
    u'''
zad1:
  defaults:
    timeout: 3 # second
    input_file: zad_input.txt
    output_file: zad_output.txt
  validator: perlines_validator
  cases:
    - inp: |
        159 319
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        78 1 8 37 41 37 10 2 23 38
        78 41 37 41 79 37
        78 79 41 117
        78 79 41 117
        78 121 117
        78 17 2 54 17 3 17 54 2 55
        78 19 4 54 16 4 19 56 2 1 55
        98 4 54 16 4 19 56 2 1 55
        98 4 54 16 4 19 56 2 1 55
        98 4 54 16 4 19 56 2 1 55
        91 4 4 2 49 12 2 4 4 12 49 4 2 1 2 50
        93 4 4 4 49 11 4 4 4 14 49 6 2 1 2 1 50
        93 4 4 4 49 11 4 4 4 14 49 4 1 2 1 2 52
        93 4 4 4 49 11 4 4 4 14 49 6 2 1 2 1 50
        93 4 4 4 49 11 4 4 4 14 49 6 2 1 4 50
        86 4 4 4 4 2 44 7 2 4 4 4 4 7 44 2 6 2 1 2 4 45
        88 4 4 4 4 4 44 11 4 4 4 4 9 49 6 2 1 2 4 47
        86 1 2 1 4 4 4 4 44 6 4 4 4 4 4 9 44 4 6 2 1 2 4 1 45
        86 4 1 4 4 4 4 44 11 4 4 4 4 9 44 4 6 2 1 2 4 47
        86 4 1 4 4 4 4 44 9 1 4 4 4 4 9 44 4 4 1 2 1 2 1 2 1 45
        81 2 4 1 4 4 4 4 2 39 2 5 1 4 4 4 4 4 2 39 2 4 4 1 2 1 2 1 2 1 2 40
        81 4 4 1 4 4 4 4 4 39 4 4 1 4 4 4 4 4 4 39 1 2 4 4 1 2 1 2 1 2 1 4 40
        79 1 4 4 1 4 4 4 4 4 1 37 1 4 2 1 4 4 4 2 1 7 1 38 4 4 4 1 2 1 2 1 2 1 2 1 1 38
        86 4 1 4 2 1 4 4 49 4 1 2 1 4 4 4 4 49 4 4 1 2 6 2 1 2 42
        86 4 1 4 2 1 4 4 2 46 4 1 9 4 4 4 49 4 4 1 2 9 1 2 42
        76 2 2 2 4 1 4 2 1 2 1 2 1 2 6 32 4 6 1 2 1 4 4 2 1 44 6 2 4 4 1 2 9 1 2 1 35
        76 9 4 1 4 2 6 2 1 9 44 1 2 6 4 2 1 54 4 4 1 2 6 2 47
        76 1 6 4 1 2 1 2 6 4 32 3 2 1 2 6 4 2 1 2 1 32 1 1 4 4 1 2 6 2 2 2 1 35
        91 1 2 1 2 4 1 2 56 4 6 4 2 1 59 4 1 2 6 2 47
        91 4 1 2 4 4 56 1 2 6 4 2 61 4 1 2 9 47
        71 19 4 1 2 4 1 19 22 18 2 4 1 4 2 18 22 19 4 1 2 26 30
        71 19 4 1 2 4 21 41 2 4 1 7 41 19 4 1 2 1 55
        71 4 4 4 2 22 2 4 1 7 22 6 2 6 30
        96 4 4 66 4 1 4 69 1 2 4 52
        93 2 4 4 66 4 4 68 4 2 4 52
        66 29 4 31 12 31 1 44 29 1 2 1 29 25
        66 29 4 31 44 1 2 41 29 1 2 1 55
        66 4 2 12 2 1 2 12 2 4 25
        101 76 1 79 57
        98 2 76 78 2 57
        61 76 2 78 76 20
        61 76 81 76 20
        61 2 2 3 3 2 20
        180 76 60
        101 76 1 76 60
        56 4 4 29 4 31 4 4 31 4 2 31 4 4 29 6 29 25
        56 4 4 29 4 31 4 4 31 2 36 4 4 29 1 2 1 29 25
        56 4 5 2 4 4 4 4 2 5 6 2 4 5 2 4 1 2 25
        56 4 34 4 4 31 4 34 36 4 34 4 1 55
        56 4 17 9 6 4 4 3 27 4 34 4 31 4 19 14 4 1 6 48
        51 4 4 4 4 19 4 4 4 1 19 4 4 4 4 21 2 4 4 4 21 4 4 4 4 19 4 4 1 4 19 30
        51 4 4 4 4 24 4 4 21 4 4 4 4 29 4 4 21 4 4 4 4 19 4 6 55
        51 4 4 4 5 2 1 1 3 2 4 4 4 4 2 2 4 4 4 4 2 2 1 2 9 4 1 4 2 1 2 4 4 4 5 2 1 2 4 6 7 30
        51 4 4 4 29 4 4 4 21 4 4 4 19 4 4 4 4 21 4 4 4 24 4 6 55
        47 2 4 4 4 5 3 1 1 2 5 4 4 4 4 3 2 1 4 5 4 4 4 3 4 2 2 3 4 4 4 6 2 1 1 3 2 4 4 4 4 5 5 4 6 4 6 35
        51 4 4 4 4 4 9 4 4 4 4 4 11 2 1 4 4 4 4 4 14 4 4 4 4 4 11 4 4 4 4 4 4 9 4 4 6 7 1 9 35
        51 4 4 4 4 4 9 4 4 4 4 4 1 9 4 4 4 4 4 4 14 4 4 4 4 4 11 4 4 4 4 4 4 9 4 4 6 7 1 9 35
        51 4 4 4 4 6 3 2 4 4 4 4 4 1 2 11 4 4 4 4 4 9 4 4 4 4 4 4 11 4 4 4 4 4 11 2 4 4 6 9 2 2 39
        51 4 4 4 4 14 4 4 4 4 4 14 1 4 4 4 4 4 9 4 4 4 4 4 4 1 9 4 4 4 4 4 14 4 4 6 9 2 42
        40 12 4 4 4 5 4 4 4 4 4 4 7 2 1 4 4 4 4 4 2 2 4 4 4 4 4 4 4 2 4 4 4 4 4 5 4 4 4 6 9 2 2 35
        39 4 11 9 4 4 4 4 4 4 4 4 4 4 1 4 2 1 4 4 4 4 4 9 4 4 4 4 4 4 1 2 6 4 4 4 4 4 4 4 4 4 4 6 9 4 4 35
        44 11 9 4 4 4 4 4 4 4 4 4 4 1 4 2 1 4 4 4 4 4 9 4 4 4 4 4 4 1 2 6 4 4 4 4 4 4 4 4 4 4 6 9 2 1 4 35
        44 11 9 4 4 9 4 4 4 4 4 11 2 1 4 4 4 4 4 14 4 4 4 4 4 11 4 4 4 4 4 4 9 4 4 6 55
        44 4 6 9 4 4 9 4 4 4 4 4 11 2 1 2 1 4 4 4 4 14 4 4 4 4 4 11 4 4 4 4 4 4 9 4 4 4 9 1 45
        37 11 9 4 4 2 4 4 4 4 4 4 2 1 4 4 4 4 4 2 4 4 4 4 4 1 5 2 4 4 4 4 4 4 2 4 4 4 9 47
        54 1 9 4 14 4 4 4 4 4 4 9 4 1 4 4 4 4 9 4 4 4 4 4 4 11 4 4 4 4 4 14 4 4 4 4 4 1 45
        49 6 14 2 11 1 2 4 4 4 4 1 2 9 1 4 4 4 4 4 9 4 4 4 4 4 4 11 4 4 4 4 4 2 11 4 4 4 4 4 1 45
        49 6 14 19 4 4 4 26 4 4 4 24 4 4 4 21 4 4 4 4 19 4 4 4 52
        49 6 14 19 4 4 4 21 2 4 1 4 4 24 4 4 4 21 4 4 4 4 19 4 4 4 52
        32 5 1 15 2 4 4 4 4 2 4 1 4 4 2 4 4 4 4 2 2 2 1 4 4 4 2 4 4 4 52
        54 1 12 21 4 4 4 4 19 4 4 1 4 19 4 4 4 4 21 2 1 4 4 24 4 4 57
        51 2 4 9 18 2 4 4 4 4 19 4 1 4 4 19 2 1 4 4 2 1 21 2 1 4 4 2 18 2 1 2 4 4 1 50
        54 4 36 4 34 1 4 34 4 29 6 4 29 4 57
        54 4 1 34 4 31 2 1 2 1 2 31 4 29 6 4 29 4 57
        27 2 2 4 2 2 2 4 4 2 4 1 2 4 4 2 6 4 2 4 57
        59 36 4 4 29 4 31 4 4 36 34 4 57
        27 1 1 2 2 4 25 2 2 2 2 1 1 4 2 1 17 2 2 1 2 1 2 1 25 4 2 28 2 1 2 1 55
        59 81 78 97
        59 78 2 78 97
        22 75 2 76 2 1 3 3 2 60
        101 76 139
        22 1 2 5 1 2 2 2 1 2 3 2 1 1 1 1 2 1 17 4 6 6 16 6 1 60
        59 78 2 78 97
        59 78 2 78 97
        27 28 2 4 1 2 21 12 28 1 4 4 1 18 2 12 2 1 1 4 2 65
        59 46 29 1 2 1 29 41 4 97
        27 5 4 2 1 12 2 6 2 12 2 4 5 1 65
        54 4 4 1 69 1 2 1 71 4 4 92
        54 4 4 71 1 2 1 71 4 4 92
        51 2 4 9 41 19 4 4 1 4 19 22 18 2 1 4 4 2 18 70
        54 4 4 4 41 24 4 1 4 19 41 4 4 4 2 89
        32 4 4 6 2 2 22 2 4 4 1 4 2 22 5 1 4 4 5 2 70
        49 4 4 4 1 4 56 2 4 4 1 4 64 1 4 4 2 1 87
        49 4 4 9 1 59 4 4 1 4 61 2 1 4 2 1 4 87
        49 4 4 9 1 2 41 9 4 4 4 1 2 1 4 9 41 4 2 1 4 2 1 2 1 2 84
        49 4 4 4 4 1 44 9 1 2 4 4 1 4 4 9 49 1 4 2 1 2 1 87
        37 5 4 4 4 4 1 5 32 2 1 2 4 4 1 4 4 2 32 9 1 4 2 1 2 1 5 75
        44 4 4 4 4 4 1 4 49 4 4 4 1 4 4 49 9 1 4 2 1 2 1 4 82
        44 4 4 4 4 4 1 4 49 4 4 4 1 4 2 1 49 9 6 2 1 2 1 4 82
        39 9 4 4 4 4 1 4 2 1 39 4 4 4 4 1 4 2 1 4 39 1 2 9 6 2 1 2 1 4 2 1 77
        39 9 4 4 4 4 1 4 4 39 9 4 4 1 2 1 2 1 4 39 4 4 4 6 2 1 2 1 4 4 77
        39 2 5 4 4 4 4 1 5 2 39 2 4 4 4 1 2 1 2 1 2 39 2 4 4 6 2 1 2 1 5 2 77
        39 9 4 4 4 4 1 9 44 4 4 4 1 2 1 2 1 44 9 4 6 2 1 4 2 6 77
        39 9 4 4 4 4 11 44 1 2 4 4 1 2 4 1 44 9 4 6 2 4 1 2 6 77
        39 9 4 4 4 4 1 9 44 4 4 4 1 2 1 2 1 44 9 4 4 1 2 4 4 6 77
        39 9 4 4 4 4 1 9 44 1 2 4 4 1 2 1 2 1 44 9 4 4 1 2 4 11 77
        39 7 5 4 4 4 2 8 44 4 4 4 1 2 5 44 7 5 4 1 2 7 7 77
        39 14 4 4 4 11 49 4 4 4 51 14 4 1 2 4 11 77
        39 14 4 4 4 11 49 4 4 4 51 14 4 1 2 4 11 77
        39 14 4 4 4 11 49 4 4 4 51 14 4 1 2 4 11 77
        39 14 4 4 4 11 49 4 4 4 1 49 14 4 1 2 4 11 77
        39 13 5 4 16 54 4 56 19 1 2 2 12 77
        39 19 4 16 54 4 56 24 16 77
        39 19 4 16 54 4 56 19 4 16 77
        39 19 4 16 54 4 56 19 4 16 77
        39 19 4 16 54 1 2 1 54 19 4 94
        39 41 116 18 100
        39 41 116 119
        39 41 116 119
        39 41 116 119
        39 41 79 36 119
        81 236
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        318
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        96 1 60
        98 60
        98 60
        98 60
        98 60
        91 1 4 2 1 55
        91 1 4 4 55
        91 1 9 55
        91 6 4 55
        91 1 4 4 55
        86 4 1 4 4 4 50
        86 4 1 4 4 4 50
        86 4 1 4 4 4 50
        86 4 1 4 4 4 50
        86 4 1 4 4 4 50
        81 4 4 1 4 4 4 4 45
        81 4 4 1 4 4 4 4 45
        77 3 4 4 1 4 4 4 4 2 21
        76 4 4 4 1 4 4 4 4 45
        76 4 4 4 1 4 4 4 4 45
        76 4 4 4 1 4 4 4 4 4 40
        76 4 4 4 1 4 4 4 4 4 40
        77 4 4 1 4 4 4 5 43
        86 4 1 4 4 4 50
        86 4 1 4 4 4 50
        71 14 4 1 4 4 4 14 35
        71 14 4 6 4 4 14 35
        80 2 5 1 4 4 4 36
        91 6 4 55
        67 12 2 11 2 52
        91 1 9 55
        91 1 4 4 24 30
        82 3 2 4 5 31
        93 4 60
        62 3 1 4 2 57
        98 60
        159
        88 3 26
        159
        57 2 13 68
        59 99
        59 38 60
        59 31 1 4 2 1 1 1 2 26
        59 38 2 57
        52 4 2 3 15 5 3 49
        54 4 4 26 9 1 55
        54 4 4 26 6 60
        54 4 4 22 2 6 4 2 1 31
        54 4 4 26 6 2 1 55
        47 4 4 4 2 3 5 6 2 1 5 1 36
        49 4 4 4 4 1 14 4 6 4 4 14 35
        49 4 4 4 4 1 14 4 6 4 4 50
        49 4 4 4 4 13 2 4 6 4 4 2 47
        49 4 4 4 4 16 4 6 4 4 50
        42 4 4 4 4 7 3 4 4 6 4 4 5 41
        49 4 4 4 6 4 4 4 4 6 4 4 4 4 40
        17 20 4 4 4 4 4 4 1 4 4 4 6 4 4 4 4 40
        17 21 2 6 4 4 4 1 4 4 4 4 4 6 4 4 4 2 42
        17 24 6 4 4 4 4 6 4 4 4 6 4 4 4 45
        17 19 9 4 4 4 6 4 2 4 4 6 4 4 4 2 20
        17 19 11 4 4 4 4 4 6 4 4 6 4 4 4 45
        17 19 4 6 4 4 4 4 4 6 4 4 6 4 4 4 45
        17 31 4 4 4 6 14 4 6 4 4 50
        17 26 4 4 4 4 6 14 4 6 4 4 50
        17 14 1 4 4 4 4 7 2 4 6 4 4 50
        17 14 16 4 4 4 4 16 4 6 4 4 50
        17 14 14 4 4 4 4 13 2 1 9 4 4 50
        17 31 4 4 4 1 31 4 55
        17 31 4 4 4 26 1 4 4 55
        17 9 6 4 4 4 2 1 1 2 6 4 55
        17 9 26 4 4 26 6 4 55
        17 9 5 2 4 4 26 1 4 2 1 55
        17 36 4 38 60
        17 36 4 99
        17 4 21 4 2 65
        17 4 36 33 4 60
        22 7 2 33 2 1 60
        17 141
        17 141
        17 4 17 2 1 2 60
        17 4 36 33 4 60
        17 4 16 33 65
        17 36 4 99
        17 36 4 38 60
        17 9 14 2 2 4 4 2 7 55
        17 9 26 4 4 26 1 4 4 55
        17 9 1 6 4 4 2 23 1 4 4 55
        17 31 4 4 4 26 1 4 4 55
        17 31 4 4 4 1 24 1 4 4 55
        17 14 9 1 2 4 4 4 4 2 2 1 4 4 2 50
        32 16 4 4 4 4 16 4 1 4 4 4 50
        32 4 4 4 4 4 3 8 2 4 1 4 4 4 50
        44 4 4 4 4 21 4 1 4 4 4 50
        44 4 4 4 4 6 14 4 1 4 4 4 50
        37 3 1 4 4 4 4 4 1 2 2 2 2 4 1 4 4 4 2 45
        37 6 4 4 4 4 4 11 4 4 1 4 4 4 4 45
        37 4 4 4 4 4 4 7 2 4 4 1 4 4 4 4 45
        44 4 4 4 4 4 1 4 4 4 4 1 4 4 4 4 45
        17 20 4 4 4 4 4 4 1 4 4 4 4 1 4 4 4 4 45
        44 4 4 4 4 4 6 4 4 4 1 4 4 4 4 2 40
        44 4 4 4 4 6 4 4 4 4 1 4 4 4 4 4 40
        42 4 4 4 4 7 2 4 4 1 4 4 4 4 4 40
        49 4 4 4 4 16 4 1 4 4 4 50
        49 4 4 4 4 16 4 1 4 4 4 50
        49 4 4 4 4 2 2 2 4 1 4 4 4 2 1 35
        49 4 4 4 4 1 14 4 1 4 4 4 50
        47 4 4 4 2 2 1 1 4 1 9 4 2 6 1 36
        54 4 4 26 1 9 55
        54 4 4 26 1 4 4 55
        54 4 4 15 1 2 2 1 4 4 2 1 31
        54 4 4 26 1 4 4 55
        52 4 2 2 5 11 55
        59 33 65
        59 41 57
        59 25 4 2 26
        59 38 60
        57 2 1 4 2 1 26 26
        159
        159
        57 1 27 2 2 1 1 26
        59 38 60
        59 2 6 2 8 26
        59 33 7 57
        59 33 4 60
        52 1 4 4 25 11 7 5 31
        54 4 4 26 1 4 4 55
        54 4 4 2 2 1 4 4 2 1 4 31
        54 4 4 26 1 4 2 1 55
        54 4 4 26 1 4 4 55
        47 1 4 4 4 4 16 4 1 4 2 1 4 6 36
        49 4 4 4 4 1 14 4 6 4 4 14 35
        49 4 4 4 4 2 2 4 6 4 4 2 35
        49 4 4 4 4 16 4 6 4 4 50
        49 4 4 4 4 16 4 6 4 4 50
        42 1 4 4 4 4 4 6 4 4 4 6 4 4 4 4 40
        44 4 4 4 4 6 4 4 4 4 6 4 4 4 4 40
        17 1 4 4 4 4 4 11 4 4 4 6 4 4 4 2 40
        44 4 4 4 4 4 6 4 4 4 6 4 4 4 45
        39 4 4 4 4 4 4 1 4 4 4 4 6 4 4 4 45
        37 4 6 4 4 4 16 4 4 6 4 4 4 23 21
        37 11 4 4 4 4 11 4 4 6 4 4 4 45
        38 1 7 4 4 4 6 2 2 2 4 6 4 4 2 45
        44 4 4 4 4 6 14 4 6 4 4 50
        34 4 4 4 4 4 4 4 16 4 6 4 4 50
        32 16 4 4 4 4 16 4 6 4 4 50
        32 16 4 4 4 4 16 4 6 4 4 50
        36 2 4 4 4 4 2 2 6 4 2 50
        49 4 4 4 26 1 4 4 55
        28 1 4 4 4 2 23 1 7 1 55
        27 26 4 4 23 2 6 4 55
        27 26 4 4 26 6 4 55
        40 1 2 4 7 2 2 7 55
        54 4 38 60
        23 1 11 4 2 34 60
        22 36 33 4 60
        22 36 38 60
        47 4 1 2 60
        159
        23 1 4 96
        22 36 33 2 1 60
        22 36 36 1 60
        51 1 4 2 3 2 62
        54 4 36 1 60
        27 2 3 4 4 4 28 60
        27 26 4 4 23 2 1 2 1 2 1 55
        27 26 4 4 26 1 2 1 2 1 55
        39 2 4 4 4 2 1 1 2 6 2 1 55
        49 4 4 4 26 1 4 2 1 55
        32 3 4 4 4 4 1 9 9 6 4 55
        32 16 4 4 4 4 16 4 4 6 2 1 50
        32 16 4 4 4 4 16 4 4 4 1 4 50
        44 4 4 4 4 4 1 1 2 4 4 4 1 4 50
        44 4 4 4 4 6 14 4 4 4 1 4 50
        37 1 2 4 4 4 4 10 1 7 4 4 4 1 4 50
        37 6 4 4 4 4 4 1 9 4 4 4 4 1 4 4 45
        37 6 4 4 4 4 4 1 9 4 4 4 4 1 4 4 45
        39 9 4 4 4 4 1 4 2 4 4 4 4 1 4 4 2 21
        44 4 4 4 4 4 1 4 4 4 4 4 6 4 4 45
        17 4 4 4 4 4 4 6 4 4 4 4 4 1 4 4 2 42
        44 4 4 4 4 6 4 4 4 4 4 4 1 4 4 4 40
        44 4 4 4 4 4 1 4 4 4 4 4 4 1 4 4 4 40
        49 4 4 4 4 16 4 4 4 1 4 4 40
        49 4 4 4 4 16 4 4 4 1 4 50
        49 4 4 4 4 2 2 4 4 4 1 4 2 47
        49 4 4 4 4 1 14 4 4 4 1 4 14 35
        47 1 4 4 4 4 1 14 4 4 4 1 4 14 35
        54 4 4 26 4 1 2 1 13 36
        54 4 4 26 4 1 2 1 55
        54 4 4 2 2 4 4 1 2 2 47
        54 4 4 26 4 6 55
        54 4 4 26 4 4 1 55
        59 26 4 4 4 1 31
        59 36 1 2 57
        59 2 4 2 4 44
        59 36 62
        59 36 36 25
        121 1 26
        159
        57 3 3 30
        59 36 1 60
        59 36 1 60
        59 33 2 4 8 26
        59 36 4 57
        52 4 2 3 4 4 2 39
        54 4 4 26 9 1 24 30
        54 4 4 26 9 1 24 30
        54 4 4 23 2 4 4 1 2 1 1 1 1 31
        54 4 4 26 4 1 2 1 55
        47 4 4 4 2 2 4 4 1 2 1 5 38
        49 4 4 4 4 16 4 4 1 2 1 4 14 35
        49 4 4 4 4 16 4 4 4 1 4 14 35
        49 4 4 4 4 13 2 4 4 4 1 4 2 7 37
        49 4 4 4 4 16 4 4 4 1 4 50
        42 1 4 4 4 4 4 2 3 4 4 4 4 1 4 5 41
        49 4 4 4 6 4 4 4 4 4 4 1 4 4 4 40
        44 4 4 4 4 6 4 4 4 4 4 4 1 4 4 4 40
        17 26 4 4 4 4 4 1 4 4 4 4 4 4 1 4 4 2 42
        39 4 4 4 4 4 6 4 4 4 4 4 4 1 4 4 45
        37 4 4 4 4 4 1 2 1 4 2 4 4 4 4 1 9 2 27
        37 6 4 4 4 4 4 1 9 4 4 4 4 1 9 45
        37 3 1 4 4 4 4 4 1 2 6 4 4 4 4 1 4 4 45
        49 4 4 4 4 1 14 4 4 4 1 4 50
        44 4 4 4 4 4 1 14 4 4 4 1 4 50
        32 1 4 4 4 4 4 2 2 4 4 4 1 4 50
        32 16 4 4 4 4 16 4 4 4 1 4 50
        32 16 4 4 4 4 16 1 2 4 4 1 2 1 50
        49 4 4 4 26 4 1 2 57
        17 31 4 4 4 26 4 4 1 55
        17 9 4 4 4 2 2 4 4 1 55
        27 26 4 4 26 4 4 1 55
        27 23 2 4 4 23 2 1 2 4 1 55
        17 36 4 36 62
        17 36 4 36 62
        17 4 6 6 1 1 5 2 2 1 60
        22 36 36 62
        22 1 2 1 29 2 1 60
        159
        159
        22 1 2 3 12 65
        22 36 99
        22 8 3 4 2 13 65
        54 4 99
        54 4 99
        27 1 10 2 4 4 17 1 70
        27 26 4 4 94
        27 1 4 2 3 4 4 4 2 3 16 70
        49 4 4 4 94
        49 4 4 4 1 92
        32 2 4 4 4 4 2 6 75
        32 16 4 4 4 4 89
        32 1 1 6 4 4 4 4 2 1 1 75
        44 4 4 4 4 4 89
        44 4 4 4 4 4 1 87
        37 1 1 4 4 4 4 4 1 2 1 80
        37 6 4 4 4 4 4 1 87
        37 2 1 4 4 4 4 4 1 5 80
        42 6 4 4 4 4 1 2 1 82
        17 21 2 6 4 4 4 4 1 4 82
        18 23 1 4 4 4 4 4 1 4 82
        42 6 4 4 4 4 1 4 82
        42 1 4 4 4 4 4 1 2 80
        49 4 4 4 4 89
        49 4 4 4 4 89
        49 4 4 4 4 89
        49 4 4 4 4 89
        47 1 4 4 4 2 1 89
        54 4 4 94
        54 4 4 94
        54 4 4 94
        54 4 4 94
        52 1 4 2 94
        59 99
        59 99
        59 99
        59 99
        57 99
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        159
        0
      out: |
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################....................#.............########.#####################################.#########################################.#####################################.##########..##...#######################.######################################.
        ##############################################################################.#########################################.#####################################.#########################################.###############################################################################.#####################################.
        ##############################################################################.###############################################################################.#########################################.#####################################################################################################################.
        ##############################################################################.###############################################################################.#########################################.#####################################################################################################################.
        ##############################################################################.#########################################################################################################################.#####################################################################################################################.
        ##############################################################################.#################...##...######################################################.#################..###..#################.######################################################...##...#######################################################.
        ##############################################################################.###################.####.######################################################.################.####.###################.########################################################.##.#.#######################################################.
        ##################################################################################################.####.######################################################.################.####.###################.########################################################.##.#.#######################################################.
        ##################################################################################################.####.######################################################.################.####.###################.########################################################.##.#.#######################################################.
        ##################################################################################################.####.######################################################.################.####.###################.########################################################.##.#.#######################################################.
        ###########################################################################################...####.####.##...#################################################.############..##.####.####...############.#################################################...####.##.#.##...##################################################.
        #############################################################################################.####.####.####.#################################################.###########.####.####.####.##############.#################################################.######.##.#.##.#.##################################################.
        #############################################################################################.####.####.####.#################################################.###########.####.####.####.##############.#################################################.####.#.##.#.##.####################################################.
        #############################################################################################.####.####.####.#################################################.###########.####.####.####.##############.#################################################.######.##.#.##.#.##################################################.
        #############################################################################################.####.####.####.#################################################.###########.####.####.####.##############.#################################################.######.##.#.####.##################################################.
        ######################################################################################...####.####.####.####.##...############################################.#######..##.####.####.####.####...#######.############################################...##.######.##.#.##.####...#############################################.
        ########################################################################################.####.####.####.####.####.############################################.###########.####.####.####.####.#########.#################################################.######.##.#.##.####.###############################################.
        ######################################################################################.#.##.#.####.####.####.####.############################################.######.####.####.####.####.####.#########.############################################.####.######.##.#.##.####.#.#############################################.
        ######################################################################################.####.#.####.####.####.####.############################################.###########.####.####.####.####.#########.############################################.####.######.##.#.##.####.###############################################.
        ######################################################################################.####.#.####.####.####.####.############################################.#########.#.####.####.####.####.#########.############################################.####.####.#.##.#.##.#.##.#.#############################################.
        #################################################################################...##.####.#.####.####.####.####.##...#######################################.##..#####.#.####.####.####.####.####...##.#######################################...##.####.####.#.##.#.##.#.##.#.##...########################################.
        #################################################################################.####.####.#.####.####.####.####.####.#######################################.####.####.#.####.####.####.####.####.####.#######################################.#.##.####.####.#.##.#.##.#.##.#.####.########################################.
        ###############################################################################.#.####.####.#.####.####.####.####.####.#.#####################################.#.####.##.#.####.####.####.##.#.#######.#.######################################..####.####.####.#.##.#.##.#.##.#.##.#.#.######################################.
        ######################################################################################.####.#.####.##.#.####.####.#################################################.####.#.##.#.####.####.####.####.#################################################.####.####.#.##.######.##.#.##.##########################################.
        ######################################################################################.####.#.####.##.#.####.####.##.##############################################.####.#.#########.####.####.####.#################################################.####.####.#.##.#########.#.##.##########################################.
        ############################################################################.##..##.##.####.#.####.##.#.##.#.##.#.##.######.################################.####.######.#.##.#.####.####.##.#.############################################.######.##.####.####.#.##.#########.#.##.#......###################################.
        ############################################################################.#########.####.#.####.##.######.##.#.#########.############################################.#.##.######.####.##.#.######################################################.####.####.#.##.######.##.###############################################.
        ############################################################################.#.######..####.#.##.#.##.######.####...........################################.....###..##.#.##.######.####.##.#.##.....#....################################.#......#..####.####.#.##.######.##.##.....##.#.###################################.
        ###########################################################################################.#.##.#.##.####.#.##.########################################################.####.######.####.##.#.###########################################################.####.#.##.######.##.###############################################.
        ###########################################################################################.####.#.##.####.####.########################################################.#.##.######.####.##.#############################################################.####.#.##.#########.###############################################.
        #######################################################################.###################.####.#.##.####.#.###################.######################.##################.##.####.#.####.##.##################.######################.###################.####.#.##.##########################.##############################.
        #######################################################################.###################.####.#.##.####.#####################.#########################################.##.####.#.#######.#########################################.###################.####.#.##.#.#######################################################.
        #######################################################################.....................####.####.####.##....................######################....................##.####.#.#######....................######################.....................######.##.######.....................##############################.
        ################################################################################################.####.####.##################################################################.####.#.####.#####################################################################.#.##.####.####################################################.
        #############################################################################################.##.####.####.##################################################################.####.####.####################################################################.####.##.####.####################################################.
        ##################################################################.#############################.####.###############################.############.###############################.#.############################################.#############################.#.##.#.#############################.#########################.
        ##################################################################.#############################.####.###############################.############################################.#.##.#########################################.#############################.#.##.#.#######################################################.
        ##################################################################...............................####.##..............................############..............................##.#.##..............................############..............................##.####...............................#########################.
        #####################################################################################################.############################################################################.#.###############################################################################.#########################################################.
        ##################################################################################################.##.############################################################################.##############################################################################.##.#########################################################.
        #############################################################.############################################################################.##.##############################################################################.############################################################################.####################.
        #############################################################.############################################################################.#################################################################################.############################################################################.####################.
        #############################################################......................................##......................................##.....................................###.....................................###.....................................##......................................####################.
        ####################################################################################################################################################################################.############################################################################.############################################################.
        #####################################################################################################.############################################################################.#.############################################################################.############################################################.
        ########################################################.####.####.#############################.####.###############################.####.####.###############################.####.##.###############################.####.####.#############################.######.#############################.#########################.
        ########################################################.####.####.#############################.####.###############################.####.####.###############################.##.####################################.####.####.#############################.#.##.#.#############################.#########################.
        ########################################################.####.#####...........................##.####.####............................####.####.##...........................#####.######............................##.####.#####...........................##.####.#.##............................#########################.
        ########################################################.####.##################################.####.####.###############################.####.##################################.####################################.####.##################################.####.#.#######################################################.
        ########################################################.####.#################.#########.######.####.####.###.###########################.####.##################################.####.###############################.####.###################.##############.####.#.######.################################################.
        ###################################################.####.####.####.####.###################.####.####.####.#.###################.####.####.####.####.#####################.##.####.####.####.#####################.####.####.####.####.###################.####.####.#.####.###################.##############################.
        ###################################################.####.####.####.####.########################.####.####.#####################.####.####.####.####.#############################.####.####.#####################.####.####.####.####.###################.####.######.#######################################################.
        ###################################################.####.####.####.#####....##.#.#..###..##.####.####.####.####...##......##.....####.####.####.####.##......##..#.##....#########.####.#.####....##.....#......##.####.####.####.#####.....##.#........##.####.######.#######..................##############################.
        ###################################################.####.####.####.#############################.####.####.####.#####################.####.####.####.###################.####.####.####.####.#####################.####.####.####.########################.####.######.#######################################################.
        ###############################################..##.####.####.####.#####..###.#.#.##..#####.####.####.####.####.###..##..#.####.#####.####.####.####.###.####.##.##..###.####.####.####.######.##..#....#..###..##.####.####.####.####.#####.........#####.####.######.####.######.........###################################.
        ###################################################.####.####.####.####.####.#########.####.####.####.####.####.###########.##.#.####.####.####.####.####.##############.####.####.####.####.####.###########.####.####.####.####.####.####.#########.####.####.######.#######.#.#########.###################################.
        ###################################################.####.####.####.####.####.#########.####.####.####.####.####.#.#########.####.####.####.####.####.####.##############.####.####.####.####.####.###########.####.####.####.####.####.####.#########.####.####.######.#######.#.#########.###################################.
        ###################################################.####.####.####.####.######.###..##.####.####.####.####.####.#.##.###########.####.####.####.####.####.#########.####.####.####.####.####.####.###########.####.####.####.####.####.###########.##.####.####.######.#########.##.##.#######################################.
        ###################################################.####.####.####.####.##############.####.####.####.####.####.##############.#.####.####.####.####.####.#########.####.####.####.####.####.####.#.#########.####.####.####.####.####.##############.####.####.######.#########.##.##########################################.
        ########################################....############.####.####.####.#####.....####.####.####.####.####.####.#######.....##.#.####.####.####.####.####.##.....##.####.####.####.####.####.####.####.....##.####.####.####.####.####.#####.....####.####.####.######.#########.##.##.....###################################.
        #######################################.####.###########.#########.####.####.####.####.####.####.####.####.####.####.#.####.##.#.####.####.####.####.####.#########.####.####.####.####.####.####.#.##.######.####.####.####.####.####.####.####.####.####.####.######.#########.####.####.###################################.
        ############################################.###########.#########.####.####.####.####.####.####.####.####.####.####.#.####.##.#.####.####.####.####.####.#########.####.####.####.####.####.####.#.##.######.####.####.####.####.####.####.####.####.####.####.######.#########.##.#.####.###################################.
        ############################################.###########.#########.####.####.#########.####.####.####.####.####.###########.##.#.####.####.####.####.####.##############.####.####.####.####.####.###########.####.####.####.####.####.####.#########.####.####.######.#######################################################.
        ############################################.####.######.#########.####.####.#########.####.####.####.####.####.###########.##.#.##.#.####.####.####.####.##############.####.####.####.####.####.###########.####.####.####.####.####.####.#########.####.####.####.#########.#.#############################################.
        #####################################........###########.#########.####.####........##.####.####.####.####.####.####........##.#.####.####.####.####.####.##........####.####.####.####.####.#.#####.......##.####.####.####.####.####.####........##.####.####.####.#########.###############################################.
        ######################################################.#.#########.####.##############.####.####.####.####.####.####.#########.####.#.####.####.####.####.#########.####.####.####.####.####.####.###########.####.####.####.####.####.##############.####.####.####.####.####.#.#############################################.
        #################################################.######.##############.##.###########.#.##.####.####.####.####.#.##.#########.#.####.####.####.####.####.#########.####.####.####.####.####.####.###########.####.####.####.####.####.##.###########.####.####.####.####.####.#.#############################################.
        #################################################.######.##############.###################.####.####.####.##########################.####.####.####.########################.####.####.####.#####################.####.####.####.####.###################.####.####.####.####################################################.
        #################################################.######.##############.###################.####.####.####.#####################.##.####.#.####.####.########################.####.####.####.#####################.####.####.####.####.###################.####.####.####.####################################################.
        ################################.................#####.#.###############.................##.####.####.####.####..................##.####.#.####.####.##..................####.####.####.####.##.................##.##.#.####.####.####..................##.####.####.####.####################################################.
        ######################################################.#.############.#####################.####.####.####.####.###################.####.####.#.####.###################.####.####.####.####.#####################.##.#.####.####.########################.####.####.#########################################################.
        ###################################################.##.####.#########.##################.##.####.####.####.####.###################.####.#.####.####.###################.##.#.####.####.##.#.#####################.##.#.####.####.##.##################.##.#.##.####.####.#.##################################################.
        ######################################################.####.####################################.####.##################################.#.####.##################################.####.#############################.######.####.#############################.####.#########################################################.
        ######################################################.####.#.##################################.####.###############################.##.#.##.#.##.###############################.####.#############################.######.####.#############################.####.#########################################################.
        ###########################...........................##.##.####.##.....................##....##.####.####............................##.####.#.##............................####.####.##............................######.####............................##.####.#########################################################.
        ###########################################################.####################################.####.####.#############################.####.###############################.####.####.####################################.##################################.####.#########################################################.
        ###########################...#.................#.##.....##.####.#########################.##.##...##...##...........................#.#.####.##..#.....#################..##.##.#.##.#.##..#.#########################.####.##.############################.##.#.##.#.#######################################################.
        ###########################################################.#################################################################################.##############################################################################.#################################################################################################.
        ###########################################################.##############################################################################.##.##############################################################################.#################################################################################################.
        ######################.###########################################################################.##.############################################################################.##....#..###...........................###.....##..............................############################################################.
        #####################################################################################################.############################################################################.###########################################################################################################################################.
        ######################.......#.....................##.....#####....#...........................##..##..##.#.....................##...###...##...#.#.......................#..#.....##..#.......#################..####.######..######...################.######.#.############################################################.
        ###########################################################.##############################################################################.##.##############################################################################.#################################################################################################.
        ###########################################################.##############################################################################.##.##############################################################################.#################################################################################################.
        ###########################.############################.##.####..#.##..#####################.############.############################..#.####..####.#.##################.##.############....##.......#...........#....####.##..............................#################################################################.
        ###########################################################.##############################################.#############################.#.##.#.#############################.#########################################.####.#################################################################################################.
        ###########################...........................#####.####.##.#.........................############............................##.######.##............................############...........................##.####.#####......................#....#################################################################.
        ######################################################.####.####.#.#####################################################################.#.##.#.#######################################################################.####.####.############################################################################################.
        ######################################################.####.####.#######################################################################.#.##.#.#######################################################################.####.####.############################################################################################.
        ###################################################.##.####.#########.#########################################.###################.####.####.#.####.###################.######################.##################.##.#.####.####.##.##################.######################################################################.
        ######################################################.####.####.####.#########################################.########################.####.#.####.###################.#########################################.####.####.####.##.#########################################################################################.
        ################################..................####.####.######.##.##.................######################..................##.####.####.#.####.##..................######################.................#####.#.####.####.#####.........##......######################################################################.
        #################################################.####.####.####.#.####.########################################################.##.####.####.#.####.################################################################.#.####.####.##.#.#######################################################################################.
        #################################################.####.####.#########.#.###########################################################.####.####.#.####.#############################################################.##.#.####.##.#.####.#######################################################################################.
        #################################################.####.####.#########.#.##.#########################################.#########.####.####.####.#.##.#.####.#########.#########################################.####.##.#.####.##.#.##.#.##.####################################################################################.
        #################################################.####.####.####.####.#.############################################.#########.#.##.####.####.#.####.####.#########.#################################################.#.####.##.#.##.#.#######################################################################################.
        #####################################.......#####.####.####.####.####.#.#####.......################################........##.#.##.####.####.#.####.####.##........################################........#########.#.####.##.#.##.#.#####.......###########################################################################.
        ############################################.####.####.####.####.####.#.####.#################################################.####.####.####.#.####.####.#################################################.#########.#.####.##.#.##.#.####.##################################################################################.
        ############################################.####.####.####.####.####.#.####.#################################################.####.####.####.#.####.##.#.#################################################.#########.######.##.#.##.#.####.##################################################################################.
        #######################################.#########.####.####.####.####.#.####.##.#.#######################################.####.####.####.####.#.####.##.#.####.#######################################.#.##.#########.######.##.#.##.#.####.##.#.#############################################################################.
        #######################################.#########.####.####.####.####.#.####.####.#######################################.#########.####.####.#.##.#.##.#.####.#######################################.####.####.####.######.##.#.##.#.####.####.#############################################################################.
        #######################################.##..#####.####.####.####.####.#.#####..##.#######################################...##.####.####.####.#.##.#.##.#.##...#######################################.##...####.####.######.##.#.##.#.#####..##.#############################################################################.
        #######################################.#########.####.####.####.####.#.#########.############################################.####.####.####.#.##.#.##.#.############################################.#########.####.######.##.#.####.##.######.#############################################################################.
        #######################################.#########.####.####.####.####.###########.############################################.#.##.####.####.#.##.####.#.############################################.#########.####.######.##.####.#.##.######.#############################################################################.
        #######################################.#########.####.####.####.####.#.#########.############################################.####.####.####.#.##.#.##.#.############################################.#########.####.####.#.##.####.####.######.#############################################################################.
        #######################################.#########.####.####.####.####.#.#########.############################################.#.##.####.####.#.##.#.##.#.############################################.#########.####.####.#.##.####.###########.#############################################################################.
        #######################################.#######..#####.####.####.####.##.########.############################################.####.####.####.#.##.#####..############################################.#######..#####.####.#.##.#######..#######.#############################################################################.
        #######################################.##############.####.####.####.###########.#################################################.####.####.####.###################################################.##############.####.#.##.####.###########.#############################################################################.
        #######################################.##############.####.####.####.###########.#################################################.####.####.####.###################################################.##############.####.#.##.####.###########.#############################################################################.
        #######################################.##############.####.####.####.###########.#################################################.####.####.####.###################################################.##############.####.#.##.####.###########.#############################################################################.
        #######################################.##############.####.####.####.###########.#################################################.####.####.####.#.#################################################.##############.####.#.##.####.###########.#############################################################################.
        #######################################.#############.#####.####.################.######################################################.####.########################################################.###################.#.##.##..############.#############################################################################.
        #######################################.###################.####.################.######################################################.####.########################################################.########################.################.#############################################################################.
        #######################################.###################.####.################.######################################################.####.########################################################.###################.####.################.#############################################################################.
        #######################################.###################.####.################.######################################################.####.########################################################.###################.####.################.#############################################################################.
        #######################################.###################.####.################.######################################################.#.##.#.######################################################.###################.####.##############################################################################################.
        #######################################.#########################################.####################################################################################################################.##################.####################################################################################################.
        #######################################.#########################################.####################################################################################################################.#######################################################################################################################.
        #######################################.#########################################.####################################################################################################################.#######################################################################################################################.
        #######################################.#########################################.####################################################################################################################.#######################################################################################################################.
        #######################################.#########################################.###############################################################################.####################################.#######################################################################################################################.
        #################################################################################.############################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
        ##############################################################################################################################################################################################################################################################################################################################.
      timeout: 0.05
    - inp: |
        70 110
        2 2 2
        2 2 3
        6 5
        3 1 1 4
        6 1 5
        14 9 1
        5 4 14 1 3 1
        14 8 1 20
        2 1 1 12 17 2 1
        1 3 2 5 2 5 10 4 2
        1 14 3 2 12 2
        6 1 5 2 3 3 4 12 2
        2 2 2 5 5 3 20 2
        3 9 14 1 14 2
        2 24 1 12 2
        2 24 2 1 10 3
        2 10 11 2 1 3 5 2
        3 1 6 2 4 5 5 1 3 6 2
        1 2 4 1 1 14 1 13 2
        2 6 1 3 1 6 1 1 13 2
        4 4 2 2 7 5 15 1
        1 3 2 5 2 1 3 12 1
        2 1 11 4 1 1 3 11
        1 2 3 9 3 4 4 10 4
        4 1 1 5 3 4 2 6 4 3 3 6
        3 1 22 5 9 3 8
        6 1 4 20 1 12 8 3
        4 1 1 12 12 16 12
        3 3 1 23 31
        6 3 1 20 6 9 4 3 1
        3 1 2 2 12 9 4 10 2 7
        3 6 13 9 3 1 8 2 7 5
        3 2 3 1 1 18 4 9 25
        8 1 16 2 2 29 7
        4 3 1 15 4 2 38
        2 4 1 1 7 8 4 2 24 11
        2 5 9 9 8 23 3 6
        7 10 10 6 2 13 8 4 4
        3 1 22 5 2 10 1 9 13
        4 23 7 9 10 6 6
        2 25 7 20 7 2
        27 1 1 3 7 2 8 1 7
        10 13 4 2 2 1 4 4 8 7
        11 13 4 4 2 9 9 3 1 1
        11 14 3 5 19 7
        13 2 12 4 11 7 7 5 3
        16 2 13 1 9 1 1 1 11 6 3
        9 6 2 14 2 9 1 1 14 6 1 1
        11 7 24 2 6 1 2 2 2 7 3 1 2 2
        25 13 7 3 1 5 3 10 2 2
        9 37 3 1 2 6 5 7 1 2
        7 5 7 20 2 2 2 21 2 1
        5 4 25 2 3 5 8 14 4 5
        2 2 3 25 3 4 8 1 3 2 8 6
        5 30 2 6 3 2 3 14 2 2
        4 30 3 3 8 3 2 22 1 1
        4 31 3 4 7 3 1 3 5 6 1 2
        4 35 12 4 2 5 5 2 2 2
        3 5 18 7 15 4 2 12 2 2
        4 5 29 13 6 4 6 2 2
        2 1 4 30 14 5 3 6 3 1 1
        1 4 31 12 5 4 8 2 1 1 3
        3 22 3 4 12 6 3 6 2 2 1 1
        3 7 13 3 6 1 23 8 5 3
        3 4 3 22 11 8 3 4 5 4
        3 4 3 21 27 2 5 6
        3 3 3 3 15 6 20 2 6 7 1
        3 3 5 13 6 21 2 11 3 2 2
        4 3 5 10 27 2 6 5 5 2
        4 3 19 28 3 13 2 4
        2
        4
        4 1
        6
        5 1
        5
        2 2 3
        4 5
        4 7
        3 6 2
        3 6
        2 3 5
        4 3 5
        2 3 2 1 3 4
        5 3 4 3 4
        3 2 7 3 3 6
        1 1 2 7 4 3 11
        2 1 4 5 4 16
        2 7 1 4 4 16
        2 7 4 4 4 13
        1 7 3 2 1 4 19
        8 4 1 4 21
        7 2 5 8 9 3
        2 5 4 5 3 8 11 2
        1 5 7 2 3 1 3 4 2 11 1
        1 5 4 4 1 6 4 3 11
        2 5 1 16 2 4 17
        2 4 4 5 9 23
        1 1 4 1 5 3 1 2 25
        1 3 2 1 2 6 2 27
        6 1 1 1 27
        6 1 4 2 26 2
        2 4 5 3 10 17 2
        2 4 5 2 9 3 14 3
        1 5 10 7 4 14 2
        1 7 1 7 2 8 3 1 6 8 2
        2 7 1 10 8 2 3 6 4 3 1
        1 7 1 9 6 2 10 3 4 1
        2 6 1 2 9 9 21 1
        12 10 33 1
        6 1 1 38 4 1
        9 1 2 34 7
        4 5 2 45
        3 3 1 7 6 32
        2 1 3 8 4 32
        1 7 1 11 19 1 9
        2 1 6 10 19 2 7
        2 2 2 1 28 1 6
        4 29 2 1 1 5
        1 26 3 1 4 4
        31 1 4 1 3
        4 4 15 6 1 5 1 1
        13 22 4 2 11
        2 2 1 19 4 1 14
        2 1 8 5 7 4 1 15
        2 2 14 6 6 15
        2 2 20 8 15
        2 4 22 3 13
        2 13 6 1 5 9 1 11 2
        4 12 5 9 10 15
        13 12 1 5 5 4 15
        1 5 6 12 8 5 7 8
        3 25 1 4 2 7 7 9
        23 8 6 4 7 1 1 5
        1 4 1 14 9 7 4 7 1 7
        1 6 13 10 5 4 1 4 1 7
        2 3 12 12 1 5 1 1 2 7
        7 6 1 12 5 3 8
        3 6 2 15 5 2 13
        1 7 2 19 2 13
        2 6 2 23 18
        7 1 1 3 14 6 1 9
        5 6 1 16 5 2 2 5
        5 5 11 3 7 2 1 5
        4 5 9 6 9 7
        4 5 19 4 6
        4 19 8 6
        4 2 11 1 3 2 4 5
        3 1 3 10 5 3 4
        2 2 4 5 7 10 2 3
        2 2 3 3 6 17 1
        2 2 2 3 17 4 2
        2 2 2 30
        4 1 4 17 4 2 1
        1 1 2 3 25 3 3
        2 1 2 2 1 1 12 3 2 2 12
        2 3 2 14 2 2 2 10
        6 1 2 11 2 11 2 2
        5 1 3 9 2 9 4 2
        3 5 4 4 5 4 3
        2 3 5 4 10 3
        4 1 3 3 3 6 4
        1 1 4 4 3 3 1 4
        1 1 6 4 3 4 1 2 1
        1 4 4 1 6 4 5
        1 4 5 6 3 5
        1 4 3 5 2 6
        1 5 3 4 1 2 3
        1 4 4 2 1 2 1 2 3
        1 4 1 9 4 3 2 1
        1 6 8 4 1 2 1 1
        1 1 4 8 1 3 4 4
        1 4 2 7 2 2 1 2 5
        3 8 2 1 2 1 3 1 4
        1 5 2 1 4 2 1 2 1
        2 5 4 2 2 4
        1 2 2 3 2 1 1
        2 1 1 3 1
        4 4 1 2 3
        3 9 4
      out: |
        .............................................................##.##.....................##.....................
        ..............................................................##..##..................###.....................
        ..............................................................######.................#####....................
        ...............................................................###.#.................#.####...................
        ............................................................######.#...................#####..................
        ............................................................##############.....#########...#..................
        ...........................................................#####.####.##############..#..###...........#......
        ........................................................##############.########....#.####################.....
        ............................##........#........#....############.....#################...##............#......
        ...........................#........###.......##...#####...##.#####.##########.####.....##....................
        ...................#...##############.......###....##.......############................##....................
        ..................######..#..#####....##..###......###.####.############...............##.....................
        .................##..##.##.#####...#####.###.......####################...............##......................
        ...............###..#########.##############........#....##############..............##.......................
        ..............##...########################.........#....############...............##........................
        ..............##..########################...##.....#.....##########..............###.........................
        .............##..##########.....###########.##......#.....###.#####..............##...........................
        ............###.#.######..##......####.#####.#####..#....###.######.............##............................
        ............#.##..####..#..#.......##############...#.#############............##.............................
        ............##.######...#..###.........#.######.#...#.#############............##.............................
        ...........####.####...##.##........#######.#####...###############............#..............................
        ...........#.###.##.#####.............##...#.###......############.............#..............................
        ..............##.#.###########.........####.#.#...###.###########.............................................
        .............#.##..###.#########..###.....####...####.##########.....####.....................................
        .............####..#.#..#####...###.####...##..######.####..###.....###.######................................
        ..............###..#.....######################.#####.#########...###...########..............................
        .............######.#.....####.####################.#..############..########..###............................
        ..............####..#.....#..############.############.################.############..........................
        ................###.....###..#.#######################.###############################........................
        ................######..###..#....####################.######..#########....####..###.#.......................
        .................###...#.##.##.############..#########.####...##########....##....#######.....................
        ..................###..######..#############.#########.###.#...########.##..#######...#####...................
        ...................###.##.###...#.#.##################..####...#########.#########################............
        ....................########.......#...################.##.##.#############################...#######.........
        ....................####..###......#....###############.####.##.######################################........
        .....................##.####.#......#..#######.########.####.##..########################.###########.........
        ......................##.#####.....#########..#########.########..#######################..###...######.......
        ......................#######....##########..##########.######.##..#############.########...####....####......
        .......................###.#....######################...#####.##..##########.#.#########....#############....
        ........................####....#######################....#######..#########.##########.....######..######...
        .........................##....#########################....#######.####################......#######..##.....
        .............................###########################.#...#.###.#######.##..########........#..#######.....
        ...........................##########.#############.####.##.....##.#.####.####.########............#######....
        .........................###########..#############.####.####...##.#########.#########.............###.#.#....
        .......................###########...##############..###..#####...###################..............#######....
        .....................#############..##.############..####.###########.#######.#######.............#####.###...
        .................################..##..#############....#.#########.#.#.#.###########.............######.###..
        ................#########..######.##..##############...##.#########.#.#.##############.............######..#.#
        .............###########.#######.########################.##.######...#.##.##..##.#######...###....#.##.....##
        ..........#########################.#############.#######.###.#..........#####..###.##########........##....##
        ........#########...#####################################.###.#.##.......######.#####....#######......#....##.
        ......#######......#####..#######....####################..##..##........##.#####################.......##..#.
        .....#####.........####...#########################....##.###.#####.########.##############...####....#####...
        ....##.##..........###.#########################....###.......####..########....#.###..##...########.######...
        ...#####.........##############################....##........######...###.##....###.##############.##...##....
        ...####.........##############################..###...###.########....###.##.....######################...#..#
        ..####........###############################.###....####.#######.....###.#.......###..#####......######..#.##
        .####.......###################################.....############....####.##...........#####..#####..##...##.##
        .###.......#####.##################...#######...###############....####.##...........############.......##..##
        ####......#####.#############################....#############.....######............####.######.......##...##
        ##..#.....####.##############################...##############....#####..............###.######......###.#...#
        ..#......####..###############################...############.#####.####............########........##.#.#.###
        .........###...######################.###.####.....############....######...........###.######....##.##.#....#
        ........###....#######.#############.###.######...#.#######################.........########.......#####...###
        ........###....####.###...######################....###########.########..###........####.......#####....####.
        .......###.....####..###....#####################..###########################.......##.......#####...######..
        .......###......###...###...###....###############..######.####################......##....######..#######...#
        ......###.......###..........#####....#############.######.#####################....##...###########.###.##.##
        ......####......###............#####.....##########..###########################....##.######.#####.#####...##
        ......####......###..............###################.############################..###.#############.##...####
      timeout: 2.5
    - inp: |
        20 20
        4
        2 1 1
        3 3
        10
        2 4 2
        4 2 1
        6 2 1
        7 2
        7 2
        7 2
        6 2
        6 2
        5 2 6
        9 7
        8 4
        3 3 5
        2 3 2 1
        2 3
        1 2
        2
        1
        2
        2
        3
        4 3
        9
        10
        10 1
        10 2
        8 3 2
        8 2 3
        1 5 7
        2 3 2 2
        4 2 4
        10 3
        1 6 2
        2 2 2
        1 2 2
        6 2
        3 2
      out: |
        ..............####..
        .............##.#.#.
        ............###..###
        ..........##########
        .........##..####.##
        ........####..##..#.
        .......######.##..#.
        ......#######.##....
        ......#######.##....
        .....#######.##.....
        .....######.##......
        ....######.##.......
        ....#####.##..######
        ...#########.#######
        ..########.####.....
        .###.###.#####......
        ##..###...##.#......
        ....##...###........
        ....#...##..........
        .......##...........
      timeout: 1.5
    - inp: |
        20 20
        2 4 2
        1 2 1 1 5
        1 4 1 1 2 3
        1 1 1 3 1 2
        1 2 5 2 2
        1 1 1 6
        1 5 3 2 1
        2 1 1 1 4 1
        2 1 1 1 1 6
        1 1 2 5
        1 1 2 6
        1 1 1 3 2
        1 1 2 3 3
        3 3 3 1
        1 1 2 1 2
        1 2 1 3
        1 2 1 3
        4 1 1 2
        1 3 1 2 3
        1 1 3 2 2
        9
        1 2
        1 1 3
        2 8 3
        1 1 1 1
        1 1 8 3
        5 2 2
        2 1 2
        1 4 1 1
        7 1 1 6
        1 1 1 1 2
        5 1 1
        1 2 1 1 2
        5 1 1 4
        3 1 6
        2 2 7
        6 4 2
        2 2 3 2 5
        4 5 6
        2 3 7 1
      out: |
        ##.......####.##....
        #.##.....#.#.#####..
        #..####..#.#.##.###.
        #.....#..#.###..#.##
        #....##..#####.##.##
        #.....#..#...######.
        #.#####..###....##.#
        ##.#.#..#...####...#
        ##.#.#.#..#...######
        ...#.#.##.....#####.
        ...#.#..##....######
        ...#.#..#.....###.##
        ...#.#..##...###.###
        ...###....###..###.#
        ..#...#..##.....#.##
        ..#...##.#.......###
        ..#.....##...#...###
        ...####..#...#...##.
        ...#.###.#..##...###
        ...#.#.###..##...##.
      timeout: 1.5

    - inp: |
        22 15
        3
        1 4
        2 3
        2 1 2
        4
        2
        9
        9
        2 5
        2 1 1 2
        5 2
        1 3
        3 4
        9
        9
        2 6
        2 2
        2 5
        2 2
        4 2
        1
        15
        1
        1
        1 1
        2 1 1
        2 7 1
        1 7 1
        1 5 2 1
        4 3 6 1
        1 1 1 2 4 1
        2 5 6 1
        3 6 5 1
        3 3 4 1 1
        3 3 5 3 1
        7 5
        7 1
      out: |
        ........###....
        .......#.####..
        .......##.###..
        ......##.#.##..
        .......####....
        .........##....
        ......#########
        ......#########
        ......##..#####
        ...##.#...#..##
        ...#####.....##
        .......#....###
        .......###.####
        ....#########..
        ....#########..
        ....##.######..
        ....##...##....
        ....##...#####.
        ....##......##.
        ..####......##.
        .............#.
        ###############
      timeout: 3.0
    - inp: |
        20 25
        4
        6 2
        1 5 6
        14 7
        20
        4 10
        2 10
        1 12
        2 14
        1 11
        2 1
        3 5
        4 1
        1 2 3
        2 1 7
        2 11
        1 11
        11
        9
        7
        1
        1
        4
        2 3
        7
        9 1
        6 3 2
        4 2 2
        3 2 1 3
        6 2 5
        7 1 2 3
        7 3 3
        7 2 3
        7 1 3
        6 1 4
        8 5
        6 3 3
        7 3
        3 3 4
        3 3 3
        3 2 3
        4 1 3
        3 1 4
        2 3
        1 3
      out: |
        ...####..................
        ..######.............##..
        ..#.#####..........######
        ##############...#######.
        ..####################...
        ...####..##########......
        ....##..##########.......
        .....#..############.....
        .....##..##############..
        ......#...###########....
        ......##.......#.........
        .......###..#####........
        .........####...#........
        ...........#...##.....###
        ..........##...#..#######
        .........##...###########
        .........#..###########..
        ........###########......
        ......#########..........
        .....#######.............
      timeout: 3.0

    - inp: |
        25 25
        0
        0
        0
        0
        0
        0
        1 1
        1 1 1 1 1 1 1
        1 1 1 3 1 1
        3 3 3 1 1
        4 3 1 1 1
        2 1 1 1 1 1 1
        4 1 1 4
        1 2 1 2
        1 1 1 1 1
        1 1 4
        1 1 1
        5
        7
        9
        2 1 1 2
        2 1 1 1 2
        2 1 1 2
        2 1 5
        5
        0
        1 1 1
        1 1 1
        2 1
        5
        1 3
        1 2
        1 1 1
        1 4
        1 1 3 2
        1 1 1 3 1 2
        3 4 1 1
        3 10 1 2
        3 4 1 1
        1 1 1 3 1 2
        1 1 3 2
        5 4
        1 1 1 1
        2 1 1
        2 2 1
        1 1 1
        1 1
        1 1
        1 1
        0
      out: |
        .........................
        .........................
        .........................
        .........................
        .........................
        ...................#####.
        .###################.....
        .#..#...#..#....#..#.....
        .#..#...#..#...#..#......
        .##################......
        ..#..#..#..#..#..#.......
        ..#..#..#..#..#..#.......
        ..###############........
        ................#........
        ...............#.........
        ..##############.........
        .........................
        ....#........#...........
        ...###......###..........
        ....#........#...........
      timeout: 3.0
    - inp: |
        20 20
        1 1 3
        3 2
        5 1 1 2
        3 1 2
        1 1 1 1 2
        2
        1 2
        3 2
        3 8
        1 10
        2 6 2
        14
        10
        2 4 2
        4 4
        1 1 5 5 1 1
        1 1 10 1 1
        2
        3 2
        3 2
        1 2
        1 1 1 2 1 2
        3 4 1 2
        3 2 1 1
        3 2 1
        1 1 1 8
        2 6
        1 1 5 3
        1 9
        1 1 6 2
        8 3
        11 2
        1 5 3 1
        2 2 6
        2 8
        2 2 1
        2 1 1
        2 1
        1 1
        1 1
      out: |
        .#...#...........###
        ..###...........##..
        .#####.#.#.....##...
        ..###...#.....##....
        .#...#.#.#...##.....
        ............##......
        ..#.......##........
        .###......##........
        .###..########......
        ..#..##########.....
        ....##.######.##....
        ...##############...
        .....##########.....
        .....##.####.##.....
        .....####..####.....
        #.#.#####..#####.#.#
        .#.#.##########.#.#.
        .........##.........
        ###.......##........
        ###........##.......
      timeout: 3.0
    - inp: |
        35 25
        25
        1 1
        1 3 1
        1 6 1
        1 8 1
        1 9 1
        1 3 6 1
        1 3 4 1
        1 1 4 2 1
        1 2 2 2 2 1
        2 2 1 1 2 1
        2 1 1 1 1 1 1
        1 3 4 1 1 4
        1 2 2 4 1 2
        1 2 1 2 3 1 1
        1 8 2 2 1
        1 6 3 1
        1 9 1
        1 7 1
        1 7 1
        1 5 1
        1 4 1
        1 5 1
        1 6 1
        1 7 1
        1 7 1
        1 7 1
        1 7 1
        1 7 1
        1 5 1
        1 5 1
        1 3 1
        1 2 1
        1 1
        25
        35
        1 2 1
        1 1 1 1
        1 2 1 1
        1 4 1
        1 2 1
        1 2 5 1
        1 1 5 9 1
        1 1 1 2 18 1
        1 2 24 1
        1 4 1 17 1
        1 3 1 4 16 1
        1 2 1 1 6 6 1
        1 4 2 5 3 1
        1 4 1 2 1 1
        1 6 3 2 1
        1 9 1 1
        1 8 2 1
        1 5 2 1
        1 1 1
        1 2 1
        1 1 1 1
        1 1 2 1
        1 2 1
        35
      out: |
        #########################
        #.......................#
        #..............###......#
        #............######.....#
        #..........########.....#
        #.........#########.....#
        #........###.######.....#
        #.......###....####.....#
        #......#..####..##......#
        #.##....##...##.##......#
        ##.##....#.#...##.......#
        ##..#....#.#.#.#........#
        #.###...####.#.#.....####
        #...##..##.####.....#..##
        #....##..#...##...###.#.#
        #.....########...##..##.#
        #......######..###......#
        #......#########........#
        #......#######..........#
        #......#######..........#
        #.......#####...........#
        #.......####............#
        #......#####............#
        #......######...........#
        #.....#######...........#
        #.....#######...........#
        #.....#######...........#
        #.....#######...........#
        #.....#######...........#
        #......#####............#
        #......#####............#
        #.......###.............#
        #.......##..............#
        #.......................#
        #########################
      timeout: 3.0

    - inp: |
        40 40
        40
        40
        7 27
        8 17
        7 9
        4 33
        4 33
        4 33
        4 14 5
        5 14 5
        5 4 2 3 4 5
        5 4 2 2 2 2 5
        5 3 3 2 3 2 5
        5 3 5 1 5 5
        5 3 5 1 5 5
        5 3 5 1 5 5
        5 3 1 3 1 1 4 5
        5 3 1 1 2 2 4 5
        5 3 1 4 5 5
        5 3 2 3 6 5
        5 2 1 4 5 2 6
        5 5 2 7 6
        6 4 1 7 2 6
        6 3 2 7 1 6
        6 6 1 5 2 6
        6 5 1 1 3 1 2 7
        6 8 1 3 2 7
        6 7 2 3 2 7
        6 10 1 1 2 8
        6 10 1 1 2 8
        6 7 2 1 3 9
        6 9 3 1 9
        6 13 1 10
        18 3 11
        17 1 1 12
        20 1 13
        20 1 14
        20 15
        21 17
        40
        40
        40
        40
        40
        5 31
        5 18
        5 7
        2 1 35
        2 35
        2 15 19
        2 7 2 16
        2 5 2 16
        2 5 2 14
        3 5 2 14
        3 5 2 2 2 9
        3 6 3 1 1 2 9
        3 12 1 3 8
        3 5 6 2 3 3 5
        3 5 6 1 3 5
        3 5 3 2 5 6
        3 5 2 2
        3 3 10 12 2 1
        3 3 3 3 6 1 1
        4 3 1 2 9 2 2
        4 3 2 4 3 2
        4 3 1 7 1 3
        4 3 2 1 5 2 1 4
        4 3 6 7 1 5
        4 3 1 10 2 6
        4 3 2 10 1 7
        4 3 10 2 8
        8 9 10
        8 1 12
        8 15
        8 20
        40
        40
        40
        40
        40
      out: |
        ########################################
        ########################################
        #######......###########################
        ########...............#################
        #######........................#########
        ####...#################################
        ####...#################################
        ####...#################################
        ####...##############..............#####
        #####..##############..............#####
        #####..####....##....###...####....#####
        #####..####.....##...##...##.##....#####
        #####..###......###..##...###.##...#####
        #####..###.....#####.#.....#####...#####
        #####..###.....#####.#.....#####...#####
        #####..###.....#####.#.....#####...#####
        #####..###....#.###..#....#.####...#####
        #####..###....#...#..##.##..####...#####
        #####..###.....#.....####..#####...#####
        #####..###......##...###..######...#####
        #####..##..#.....####....#####.##.######
        #####..#####.......##..#######....######
        ######.####..#.......#######.##...######
        ######.###..##.......#######..#...######
        ######.######..#.....#####.##.....######
        ######.#####..#..#...###.#..##...#######
        ######.########..#...###.##......#######
        ######.#######..##...###..##.....#######
        ######.##########..#.#.##.......########
        ######.##########..#.#.##.......########
        ######.#######....##.#..###....#########
        ######.#########.###.#.........#########
        ######.#############.#........##########
        ##################...###.....###########
        #################..#...#....############
        ####################.#.....#############
        ####################.#....##############
        ####################.....###############
        #####################..#################
        ########################################
      timeout: 3.0
    - inp: |
        20 20
        5
        2 3
        1 5 1
        2 1 5
        2 1 1 2 1
        3 1 4
        1 2 1 1
        1 1 2 3
        1 7 1
        1 2 2
        1 1 7
        1 5 1
        1 3 1 1
        4 1 1 2 2
        2 2 2 1 1 1 1
        3 2 5 3 1
        3 1 1 2
        2 1 2
        1 2 2
        4
        4
        3
        12 1
        3 3
        2 2 2
        2 3 2
        2 1 2
        4 1 8
        2 1 1 2 2
        3 1 2 1 1 2
        1 1 2 1 1 1
        1 3 1 1 1 1
        2 3 1 1 1 2
        2 1 3 4 1
        3 1 1 2 1 2 1
        3 3 2 2
        1 2
        1 2
        1 1
        3
      out: |
        .........#####......
        ........##..###.....
        ..#....#####..#.....
        ..##...#...#####....
        ..##...#.#.##..#....
        ..###..#....####....
        ..#.##..#....#......
        ..#..#...##..###....
        ..#...#######..#....
        ..#..##.......##....
        ..#..#..#######.....
        ..#.#####....#......
        #.###..#.....#......
        ####...#.#...##...##
        ##.##..##...#..#.#.#
        ###.##.#####..###..#
        .....###.#....#..##.
        ......##..#.....##..
        .......#...##..##...
        ............####....
      timeout: 3.0

    - inp: |
        20 30
        3
        1 2
        2 1
        1 1
        2
        2
        1
        1
        1
        5
        8
        3 6
        4 5
        4 6
        4 6
        4 5
        4 4
        3 1 10
        4 11
        8
        1
        3
        4
        4
        2 1
        3 1
        2 1
        3 1
        3 2
        2 1
        3 1
        3 1
        2 3 1
        3 2 1
        1 6 2
        2 2 2 1
        4 3 1
        2 1
        2 2
        2 1
        2 1
        3 1
        2 1
        3 1
        2 1
        3 1
        5
        4
        3
        2
      out: |
        .............###..............
        .............#.##.............
        ............##..#.............
        ............#...#.............
        ...............##.............
        ..............##..............
        ..............#...............
        ..............#...............
        ..............#...............
        ............#####.............
        ...........########...........
        ..........###...######........
        ........####.......#####......
        .......####..........######...
        .....####..............######.
        ....####.................#####
        ..####....................####
        .###..........#...##########..
        ####....###########...........
        .########.....................
      timeout: 3.0
    - inp: |
        20 25
        0
        17
        17
        17
        1 1 1 1 1
        1 4 2 1 1 1 1 4
        1 2 2 1 1 1 1 1 1
        3 2 2 1 2 1 1
        1 2 2 1 1 1 1 1 1
        17 1 1
        17 6
        15 1 4
        7
        25
        2 9 4
        1 3 7 3 2
        5 5
        2 2 2 2
        5 5
        3 3
        10 3
        3 1 3 2
        3 1 1 3 1 3
        3 1 3 1 5
        11 1 2 2
        3 7 1 5
        3 3 1 3
        3 7 2
        11 3
        3 3 3
        3 2 4 3
        3 3 3
        11 3
        3 3 3
        3 2 4 3
        3 1 3 2
        10 1 3
        2 5
        9 2 2
        1 1 2 5
        1 4 3
        1 5
        3 6
        7
        2
      out: |
        .........................
        #################........
        #################........
        #################........
        #...#...#...#...#........
        #.####.##.#.#.#.#.####...
        #...##.##.#.#.#.#.#...#..
        ###.##.##...#..##.#...#..
        #...##.##.#.#.#.#.#...#..
        #################.#....#.
        #################.######.
        .###############..#.####.
        .................#######.
        #########################
        ##.....#########.....####
        #..###..#######..###..##.
        ..#####.........#####....
        ..##.##.........##.##....
        ..#####.........#####....
        ...###...........###.....
      timeout: 3.0
    - inp: |
        20 25
        1
        2
        3
        4
        5
        1 3
        1 3
        1 2
        1 2
        1 1
        1
        1
        1
        4 1
        6 1
        9
        10
        8
        6
        4
        0
        0
        0
        0
        0
        1
        3
        5
        7
        7
        7
        7
        5
        3
        17
        4
        4
        4
        4
        3
        2
        0
        0
        0
        0
      out: |
        ..............#..........
        ..............##.........
        ..............###........
        ..............####.......
        ..............#####......
        ..............#.###......
        ..............#..###.....
        ..............#...##.....
        ..............#....##....
        ..............#.....#....
        ..............#..........
        ..............#..........
        ..............#..........
        ........####..#..........
        .......######.#..........
        ......#########..........
        .....##########..........
        ......########...........
        .......######............
        ........####.............
      timeout: 10.0
    - inp: |
        32 40
        3
        8
        8
        9 2
        12
        16
        15
        8 2
        8 1
        5 8
        10 11
        25
        26
        3 23
        3 23
        3 28
        3 30
        4 25 2
        2 6 13 2
        1 5 1 6 1 2
        5 2 3 2
        8 3 2
        4 3 2 2
        3 3 2 3
        2 2 2 2
        3 2 2 1
        2 2 2
        2 2 2
        2 2 2
        2 2 3
        2 2 3
        3 3 4
        1
        3
        5
        4 5
        3 11
        3 6 2
        3 6 1
        2 7
        12
        14
        11 4
        10 8
        9 2 5
        9 4
        9 2
        8 1
        9
        9
        8
        9
        9
        10
        10
        10
        1 11
        14
        1 14 2
        16 10
        1 29
        17 3
        17 2
        10 3 1
        9 2
        7 2
        7 2 3
        2 3 10
        5 8
        5
        5
        2
      out: |
        ................................###.....
        ............................########....
        .............................########...
        ..........................#########.##..
        ...........................############.
        ........................################
        .........................###############
        .........................########....##.
        .........................########.....#.
        ..........#####.........########........
        ........##########...###########........
        ......#########################.........
        .....##########################.........
        ....###.#######################.........
        ...###..#######################.........
        ..###...############################....
        .###...##############################...
        ####...#########################...##...
        .##...######....#############......##...
        ..#...#####.#......######...#......##...
        .....#####.##.............###......##...
        ....########..............###......##...
        ....####.###...............##......##...
        ....###..###...............##.....###...
        ....##....##...............##.....##....
        ...###.....##..............##.....#.....
        ...##......##..............##...........
        ...##......##..............##...........
        ...##.......##.............##...........
        ...##.......##.............###..........
        ....##.......##.............###.........
        ....###......###............####........
      timeout: 10.0

    - inp: |
        22 27
        0
        3
        2 2
        2 2
        3 2
        3 2
        4 2
        8
        3 2
        1 5 3 1 2
        2 13 1 1
        3 7 5
        1 2
        1 1 1 2 3
        1 2 2 1 5
        1 2 8 2 1
        3 2 2 2 5
        2 1 2 4 9
        7 6 1
        7 10
        1 13
        0
        0
        3 2
        2 4
        2 2 2
        5 2
        2 1 2
        2 4
        2 2
        2 1 2 1
        2 5 2
        3 3 3
        3 2 1 4
        5 2 1 4
        1 3 2 1 4
        2 3 2 1 4
        1 2 2 2 3
        1 2 3 2 1 2
        2 4 2 2
        2 3 1 1 2
        4 2 3 1 1
        2 3 2 1
        1 1 2 1 2
        1 1 2 2
        2 1 2 2
        2 2 2
        2 2
        0
      out: |
        ...........................
        ............###............
        ...........##.##...........
        ...........##...##.........
        ...........###...##........
        ............###...##.......
        .............####..##......
        ..............########.....
        .................###..##...
        ..#...#####.....###..#.##..
        ..##.#############.#....#..
        ...###....#######..#####...
        ....#...............##.....
        ....#....#......#..##.###..
        ....#....##....##..#.#####.
        .#.##...########..##.....#.
        .###.##..##.....##..#####..
        .##...#.##.####..#########.
        ..#######.######.........#.
        .#######.##########........
        .#......#############......
        ...........................
      timeout: 3.0

    - inp: |
        25 21
        5
        5
        5
        3 3
        3 3
        2 3
        3 3
        3 3
        4 4
        3 4
        3 3
        2 3
        3 4
        3 3
        3 3
        3 3
        15
        17
        3 4
        3 4
        4 4
        3 4
        4 4
        3 4
        3 4
        3
        5
        8
        9
        9
        10
        8 2
        8 2
        9 2
        5 2
        3 2
        6 2
        10 2
        10 2
        9 2
        12
        10
        10
        8
        5
        3
      out: |
        ........#####........
        ........#####........
        ........#####........
        .......###.###.......
        .......###.###.......
        .......##..###.......
        ......###...###......
        ......###...###......
        .....####...####.....
        .....###....####.....
        .....###.....###.....
        .....##......###.....
        ....###......####....
        ....###.......###....
        ...###........###....
        ...###.........###...
        ...###############...
        ..#################..
        ..###..........####..
        ..###..........####..
        .####...........####.
        .###............####.
        ####.............####
        ###..............####
        ###..............####
      timeout: 3.5
    - inp: |
        25 22
        6
        10
        14
        15
        7 5
        6 4
        6 3
        5 4
        5 4
        5 4
        5 4
        5 4
        5 4
        5 4
        5 4
        5 4
        4 3
        4 4
        5 5
        5 7
        6 9
        19
        13 5
        9 3
        5 1
        6
        11
        16
        18
        19
        7 6
        6 5
        5 5
        5 4
        4 4
        5 4
        4 4
        4 4
        4 4
        4 4
        5 9 5
        21
        22
        22
        4 8
        5
        1
      out: |
        ..........######......
        ........##########....
        ......##############..
        .....###############..
        ....#######....#####..
        ...######.......####..
        ..######........###...
        ..#####........####...
        .#####.........####...
        .#####.........####...
        #####..........####...
        #####..........####...
        #####..........####...
        #####..........####...
        #####..........####...
        #####..........####...
        .####...........###...
        .####...........####..
        .#####.........#####..
        ..#####.......#######.
        ..######....#########.
        ..###################.
        ...#############.#####
        .....#########....###.
        .......#####.......#..
      timeout: 3.5
    - inp: |
        25 25
        7
        11
        3 3
        3 3
        4 2
        3 2
        2 1 2
        3 6 1
        2 2 1 2
        1 1 6 1
        2 2 1 2
        3 2 2 2
        3 2 4 1 1
        2 4 1 1 2 2 1
        2 12 2 1
        1 1 15 1
        1 2 2 6 2 1
        5 5 1 1
        4 5 3
        3 6 2
        3 1 5 1
        2 1 2 2 2
        1 5 1 2
        1 5 1 2
        7 1 2
        6 6 7
        6 4 5 1
        4 1 3 5 3
        3 2 4 4
        2 1 3
        1 2 4
        2 2 1 6
        2 6 3
        2 12
        2 12
        2 7
        2 2 8
        2 1 4 5
        2 1 3 3
        2 3 1 2
        2 9
        1 1 1 2 2
        2 2 1 2
        2 1 1 1
        2 2 3
        3 3
        2 2 2
        2 1 4
        2 2
        6
      out: |
        ......#######............
        ....###########..........
        ..###........###.........
        .###...........###.......
        ####.............##......
        ###...............##.....
        ##.........#.......##....
        ###........######...#....
        ##............##.#.##....
        #..#..........######.#...
        ..##...##......#.....##..
        ###....##......##.....##.
        ###....##.....####...#.#.
        ##....####..#..#..##.##.#
        ##....############.##...#
        #..#...###############..#
        #.##.##.######......##..#
        .#####.#####..........#.#
        ####...#####..........###
        ###...######..........##.
        ###...#.#####.........#..
        ##.#.##.##.##............
        #.#####..#..##...........
        #.#####..#..##...........
        #######..#..##...........
      timeout: 3.0
    - inp: |
        14 27
        1
        3
        2 2
        2 2
        2 2
        2 2
        2 2
        2 2
        2 2
        2 2
        2 2
        2 2
        2 2
        2 2
        1
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        2
        1
      out: |
        .............#.............
        ............###............
        ...........##.##...........
        ..........##...##..........
        .........##.....##.........
        ........##.......##........
        .......##.........##.......
        ......##...........##......
        .....##.............##.....
        ....##...............##....
        ...##.................##...
        ..##...................##..
        .##.....................##.
        ##.......................##
      timeout: 3.0
    - inp: |
        25 25
        5
        3 2
        2
        2
        1
        12
        17
        21
        24
        22
        18
        1 1
        1 1 11
        1 1 2 1 1 1
        3 1 1 1 1 1
        5 3 10
        1 1 1 5 9
        5 1 1 1 9
        3 5 2 1
        1 3 1 1
        5 1 2 1
        1 5 1 1
        3 1 2 1
        1 1 3 1 1
        2 2 2 2 3 3
        3 1 1
        1 2 2 1 3
        1 12
        2 2 2 1 3
        3 3 1 1
        3
        3 3 1 1
        4 2 2 1 2
        5 12
        5 2 2 1 2
        5 3 1 1
        5
        5 1
        7 3
        6 2 3 1
        8 4 3
        2 6 1 4
        2 6 1 3
        1 6 6
        2 6 1 3
        1 6 1 3 1
        1 6 13
        1 6 1 3 1
        2 6 1 3
        1 6 6
      out: |
        ...................#####.
        .................###...##
        ................##.......
        ...............##........
        ...............#.........
        .............############
        ........#################
        ....#####################
        .########################
        ...######################
        .......##################
        ..#..........#...........
        ..#.....#.....###########
        ..#.....#.....##..#..#..#
        .###....#......#..#..#..#
        #####..###.....##########
        #.#.#.#####.....#########
        #####.#.#.#.....#########
        .###..#####....##....#...
        ..#....###.....#.....#...
        #####...#.....##.....#...
        ..#...#####...#......#...
        .###....#....##......#...
        .#.#...###...#.......#...
        ##.##.##.##.###.....###..
      timeout: 3.0

    - inp: |
        34 19
        4
        1 3
        4 1 3
        4 3
        7
        6
        1 3
        1 3
        1 4
        1 4
        1 7
        1 9
        2 12
        1 13
        1 8 5
        1 3 5 2
        1 2 5
        1 1 4
        2 4
        1 4
        1 4
        2 4
        2 4
        1 3
        2 3
        1 3
        1 3
        1 1 3
        1 1 3
        3 1 4
        7 1 3
        3 3 2
        2 2
        4
        1
        1 2
        2 7 2
        2 4 5 3
        4 2 3 4 4
        1 4 5 3 2
        1 1 2 6 2 1
        2 11 1 1
        17 2 1
        26 3
        4 22 3
        21
        13 4
        3 3
        4 2
        3 1
        3
        3
        2
      out: |
        .....####..........
        ....#..###.........
        .####.#.###........
        ..####..###........
        ....#######........
        .....######........
        .....#.###.........
        ....#..###.........
        ....#..####........
        ...#...####........
        ...#..#######......
        ...#..#########....
        ..##.############..
        ..#..#############.
        ..#..########.#####
        ..#.###.#####....##
        ..#.##..#####......
        ..#.#....####......
        ..##.....####......
        ...#.....####......
        ...#.....####......
        ...##....####......
        ...##....####......
        ....#....###.......
        ....##...###.......
        .....#...###.......
        .....#...###.......
        ....#.#...###......
        ....#.#...###......
        ...###.#..####.....
        #######.#..###.....
        .###....###..##....
        .........##...##...
        .......####........
      timeout: 3.0
    - inp: |
        25 35
        4
        1 8 1
        3 11 3
        3 14 4
        4 22
        1 4 22
        28
        27
        3 11 8
        9 9
        8 8
        7 8
        2 1 7
        2 6
        3 5
        2 4
        4
        2
        2
        2
        2
        2
        2
        2
        2
        2
        3
        4
        1 2
        4
        5
        7
        3 5
        1 5
        7
        7
        9
        11
        10 2
        11 2
        12 2 2
        9 3
        8 4 2
        15 2
        17 2
        19
        18
        15
        12
        9
        7
        4
        3
        3
        2
        3
        2
        3
        2
        2
      out: |
        ................####...............
        .......#......########............#
        ......###....###########........###
        .....###....##############....####.
        ...####....######################..
        ..#.####.######################....
        .############################......
        ###########################........
        ###...###########.########.........
        .......#########.#########.........
        ........########.########..........
        .........#######.########..........
        ...........##..#.#######...........
        ............##....######...........
        .............###..#####............
        ..............##...####............
        ...................####............
        ....................##.............
        ....................##.............
        ...................##..............
        ..................##...............
        .................##................
        ................##.................
        ...............##..................
        ...............##..................
      timeout: 3.0
    - inp: |
        10 20
        2 2 4
        1 2 2 2
        2 2 3
        2 2 2 2
        2 2 2 3
        1 2 2 2 1 1
        2 2 2 2 2
        2 2 2 8
        2 2 1 3 2
        1 2 2 3 1
        2 2 2
        1 2 2
        2 2
        2 2 1
        2 2 2
        1 2 2
        2 2
        2 2
        2 2 1
        1 2 3
        1 2 2
        3 2 2
        5 3
        2 4
        4
        1
        1
        5
        3
        1
      out: |
        ##..##..####........
        #..##..##..##.......
        ..##..##..###.......
        .##..##..##.##......
        ##..##..##..###.....
        #..##..##..##.#..#..
        ..##..##..##.##..##.
        .##..##..##.########
        ##..##...#.###...##.
        #..##...##.###...#..
      timeout: 3.0
    - inp: |
        20 30
        2
        5
        2 4 2
        4 3 1 3
        6 4 2
        3 15 1
        3 15 2 2
        3 2 9 1 1 4
        4 1 9 2 1
        5 1 7 1 4
        4 2 5 2
        1 1 2 3
        14
        1 3 2 1
        2 3 2 2
        3 2 2 3
        3 2 2 3
        28
        26
        22
        1 3
        3 4
        5 4
        6 3
        8 3
        4 3
        3 3
        3 4 7
        5 10
        3 4 3
        4 1 3
        5 1 3
        6 1 3
        6 1 3
        6 1 3
        6 1 3
        6 1 3
        5 1 3
        4 1 3
        3 2 3
        6 9
        6 10
        7 3 3
        3 2 3
        1 1 1 1 3
        2 2 1 3
        2 1 1 3
        1 1 1 4
        2 3 4
        3 3
      out: |
        ......................##......
        .....................#####....
        ......##............####.##...
        .....####...........###.#.###.
        ....######.........####.....##
        ...###..###############......#
        ...###..###############.##..##
        ..###..##.#########.#..#.####.
        .####..#..#########...##....#.
        #####..#...#######....#.####..
        .####..##...#####....##.......
        ..#.#...##.........###........
        ........##############........
        #......###..........##.......#
        ##.....###..........##......##
        ###....##...........##.....###
        .###...##...........##....###.
        .############################.
        ..##########################..
        ....######################....
      timeout: 3.0
'''
    # Sokobany
    u'''
zad2:
  defaults:
    timeout: 10 # second
    input_file: zad_input.txt
    output_file: zad_output.txt
  validator: sokoban_validator
  cases:
    - inp: |
        WWWWWW
        W.GWWW
        W..WWW
        W*K..W
        W..B.W
        W..WWW
        WWWWWW
      out: 33
    - inp: |
        WWWWWW
        W....W
        W.WK.W
        W.B*.W
        W.G*.W
        W....W
        WWWWWW
      out: 16
    - inp: |
        WWWWWWWWW
        WWW..WWWW
        W.....B.W
        W.W..WB.W
        W.G.GWK.W
        WWWWWWWWW
      out: 41
    - inp: |
        WWWWWWWW
        W......W
        W.G**BKW
        W......W
        WWWWW..W
        WWWWWWWW
      out: 23
    - inp: |
        WWWWWWWWWWWW
        WWWWWW.WWWWW
        W....WWW...W
        W.BB.....WKW
        W.B.WGGG...W
        W...WWWWWWWW
        WWWWWWWWWWWW
      out: 107
    - inp: |
        WWWWWWWW
        WWW.GGKW
        WWW.BB.W
        WWWW.WWW
        WWWW.WWW
        WWWW.WWW
        WWWW.WWW
        W....WWW
        W.W...WW
        W...W.WW
        WWW...WW
        WWWWWWWW
      out: 97
    - inp: |
        WWWWWW
        WG..WW
        WKBB.W
        WW...W
        WWW..W
        WWWWGW
        WWWWWW
      out: 30
    - inp: |
        WWWWWWWWWWW
        WWWWWWWG..W
        WWWWWWWGW.W
        WWWWWWWGW.W
        W.K.B.B.B.W
        W.W.W.W.WWW
        W.......WWW
        WWWWWWWWWWW
      out: 89
    - inp: |
        WWWWWWWWW
        WWW....WW
        WWW.WWKWW
        WWW.W.B.W
        W.GGW.B.W
        W.......W
        W..WWWWWW
        WWWWWWWWW
      out: 78
    - inp: |
        WWWWWWWW
        W.....WW
        WKBBB.WW
        W..WGGGW
        WW....WW
        WWWWWWWW
      out: 50
zad3:
  defaults:
    timeout: 10 # second
    input_file: zad_input.txt
    output_file: zad_output.txt
  validator: sokoban_validator
  cases:
    - inp: |
        WWWWWWW
        W.....W
        W.GBG.W
        W.BGB.W
        W.GBG.W
        W.BGB.W
        W..K..W
        WWWWWWW
      out: 1000000
    - inp: |
        WWWWWWWWW
        WWW..WWWW
        W.......W
        WKB***G.W
        W.......W
        WWWWWWWWW
      out: 1000000
    - inp: |
        WWWWWWW
        WWW..WW
        WWG.BWW
        WWGB.WW
        WWGB.WW
        WWGB.WW
        WWG.BWW
        WW...KW
        WWW...W
        WWWWWWW
      out: 1000000
    - inp: |
        WWWWWWWWWWWW
        WWWWWWW....W
        WWWWWWW.G..W
        WWW..WWWG..W
        W.B..B..G.WW
        W.KBB.W.G.WW
        WW....WWWWWW
        WWWWWWWWWWWW
      out: 1000000
    - inp: |
        WWWWWWWWWWWWW
        W..........WW
        W.WWWWWWW.KWW
        W.W.........W
        W.W..B...W..W
        W.BB.WWWWW..W
        WWW..W.W.GGGW
        WWWWWW.W....W
        WWWWWWWWWWWWW
      out: 1000000
    - inp: |
        WWWWWWWWWWWWW
        WWWW....WW..W
        W..BBBGGGGBKW
        W......WWW..W
        W...WWWW.WWWW
        WWWWWWWWWWWWW
      out: 1000000
    - inp: |
        WWWWWWWWWW
        WW....WWWW
        W...B.WWWW
        W..BB.WWWW
        WWW.GWWWWW
        WWWWGW.K.W
        WWWWG..B.W
        WWWWG.WWWW
        WWWWWWWWWW
      out: 1000000
    - inp: |
        WWWWWWWWW
        WWW....WW
        WWW..B.WW
        WWWWWB.WW
        WW.B.B.WW
        WGGGGW.WW
        W.....K.W
        WW..W...W
        WWWWWWWWW
      out: 1000000
    - inp: |
        WWWWWWWWW
        WWWWKWWWW
        WWWWBWWWW
        WW..G..WW
        W..W.W..W
        W.W...W.W
        W.W...W.W
        W.W...W.W
        W..W.W..W
        WW.B.B.WW
        WWWG.GWWW
        WWW...WWW
        WWW...WWW
        WWWWWWWWW
      out: 1000000
    - inp: |
        WWWWWWWWWWWWWWW
        WWWWWW.WWWWWWWW
        W.....W....WWWW
        WGWW..WBWW..WWW
        W...W.....W..WW
        WB..W.WWW..W..W
        W.W......W..W.W
        W.W.WWWW..W.W.W
        WG.K....B.*.G.W
        WWWWWWWWWWWWWWW
      out: 1000000
'''
# Komandos
'''
zad4:
  validator: komandos_validator
  defaults:
    timeout: 10 # seconds
    input_file: zad_input.txt
    output_file: zad_output.txt
  cases:
    - inp: |
        ###########
        #BSSSSSSSS#
        ###########
      out: 150
    - inp: |
        ######################
        #SSSSSSSS#SSS##SSSSSS#
        #SSSSSSSSSSSS##SSSSSS#
        #SSSSSS###SSSSSSSSS#B#
        #SSSSSS###SSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        #####SSSSSSSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        ######################
      out: 150
    - inp: |
        ######################
        #SSSSSSSS#SSSSSSSSSBS#
        #SSSSSSSSSSSS##SSSSSS#
        #SSSSSSSS#############
        #SSSSSS###SSSSSSSSSSS#
        #SSSSSS###SSSSSSSSSSS#
        #SSSSSSSS#SSSSSSSSSSS#
        ##S#######SSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        ######################
      out: 150
    - inp: |
        ######################
        #SSSSSSSS#SSS##SSSSSS#
        #SSSSSSSSSSSS##SSSSSS#
        #SSSSSS###SSSSSSSSS#B#
        #SSSSSS###SSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        #####SSSSSSSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        ######################
      out: 150
    - inp: |
        ######################
        #SSSSSSSS#SSS##SSSSBS#
        #SSSSSSSS#SSS##SSSSSS#
        #SSSSSS###SSSSSSSSSSS#
        #SSSSSS###SSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        #####SSSSSSSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        ######################
      out: 150
    - inp: |
        ######################
        #SSSSSSSSSSSSSSS#SSBS#
        #SSBSSSSBSSSSSSS#SSSS#
        #########S#######S####
        #SSSSS#SSSSSSSSSSSSSB#
        ##SSS##SSSS###########
        #SSSS#SSSSSSSSSSSSSSS#
        #S##S###########SSSSS#
        #SSSS#SSSSSSSSSSSSSSS#
        #SSSSSSSS###SS####SSS#
        ######################
      out: 150
    - inp: |
        ######################
        #SSSSSSSS#SSSSSSSSSBS#
        #SSSSSSSSSSSS##SSSSSS#
        #SSSSSSSS#############
        ###SSSSSS###SSSSSSSSB#
        ###SSSSSS#S#SSSSSSSSS#
        #SSSSSSSS#SSSSSSSSSSS#
        ##S############SSS####
        #SSSSSSSSSSSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        ######################
      out: 150
    - inp: |
        ######################
        #SSSSSSSS#SSSSSSSSSBS#
        #SSSSSSSSSSSS##SSSSSS#
        #SSSSSSSS#############
        #SSSSSS###SSSSSSSSSSS#
        #SSSSSS###SSS#SSSSSSS#
        #SSSSSSSS#SSS#SSSSSSS#
        ##S#######SSS####SSSS#
        #SSSSSSSSSSSSSSS#SSSS#
        #SSSSSSSSSSSSSSS##SSS#
        #SSSSSSSSSSSSSSSSSSSS#
        #SSSS#################
        #SSSSSSSSSSSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSS#
        ######################
      out: 150
    - inp: |
        ######################
        #SSSSSSSSSSSSSSSSSSBS#
        #SSBSSSSBSSSSSSSSSSSS#
        #########S#######S####
        #SSSSS#SSSSSSSSSSSSSB#
        ##SSS##SSSS###########
        #SSSS#SSSSSSSSSSSSSSS#
        #S##S###########SSSSS#
        #SSSS#SSSSSSSSSSSSSSS#
        #SSSSSSSSSS####SSSSSS#
        ######################
      out: 150
    - inp: |
        ##########################
        #SSSSSSSSSSSSSSSSSSSSSSSS#
        #SSSSSSSSS############S###
        #SSSSSSSSSSSSSSSSS#SSSSSS#
        #SSSSSSSSSSSSSSSSS#SSSBSS#
        ##########SSSSSSSS#SBSSSS#
        #SSSSSSSSSSSSSSSSS#SSSBSS#
        ##########################
      out: 150
    - inp: |
        #######################
        #SSSSSSS#BSSSS#BSS#SSB#
        #SSSSSSSSSSSSSSSSSSSSS#
        #SSSSSSSSS#####SSSSSSS#
        #SSSSSSSSS#####SSSSSSS#
        #SSSSSSSSS#####SSSSSSS#
        #SSSSSSSSSSSSSSSSSSSSS#
        #SS##########SSSSSSSSS#
        #SS##########SSSSSSSSS#
        #SS##########SSSSSSSSS#
        #SSSSSSSSSSSSSSSSSSSSS#
        #######################
      out: 150
zad5:
  validator: komandos_validator
  defaults:
    timeout: 20 # seconds
    input_file: zad_input.txt
    output_file: zad_output.txt
  cases:
    - inp: |
        #####
        #G  #
        #   #
        #  G#
        #S# #
        #   #
        #SSS#
        #####
      out: 5
    - inp: |
        #####
        #G# #
        # S #
        #  G#
        #S# #
        #   #
        #SSS#
        #####
      out: 7
    - inp: |
        #####
        #B#S#
        #SSS#
        #SSB#
        #S#S#
        #SSS#
        #SSS#
        #####
      out: 9
    - inp: |
        ############
        #   SSS#   #
        #  #####   #
        #    #   G #
        #   SSS    #
        ############
      out: 17
    - inp: |
        ############
        #   SSS    #
        ########## #
        #    G     #
        # ##########
        #   SSS    #
        ############
      out: 23
    - inp: |
        ######################
        #        #   ##S     #
        #            ##      #
        #      ###         #G#
        #      ###           #
        #                    #
        #####         S      #
        #                    #
        ######################
      out: 12
    - inp: |
        ######################
        #        #   ##S     #
        #            ##      #
        #      ###         #G#
        #S     ###           #
        #                    #
        #####         S      #
        # S                  #
        ######################
      out: 26
    - inp: |
        ######################
        #        #         G #
        #            ##      #
        #       S#############
        #      ###           #
        #      ###           #
        #        #           #
        ## #######           #
        #   S                #
        #                    #
        #                    #
        #                    #
        #                    #
        #                    #
        #                  S #
        ######################
      out: 50
    - inp: |
        ######################
        #        #   ##S     #
        # S          ##      #
        #    S ###         #G#
        #      ###           #
        #                    #
        #####        SS      #
        #S                   #
        ######################
      out: 28
    - inp: |
        ######################
        #        # SS##    G #
        #        # SS##      #
        #      ###           #
        #      ###           #
        #                    #
        #####                #
        #S                   #
        ######################
      out: 26
    - inp: |
        ######################
        #     S         #  G #
        #  G    G       #    #
        ######### ####### ####
        #     #             G#
        ##   ##    ###########
        #    #               #
        # ## ###########     #
        #    #    S          #
        #        ###  ####   #
        ######################
      out: 22
    - inp: |
        ######################
        #                  G #
        #  G    G            #
        ######### ####### ####
        #     #             G#
        ##   ##    ###########
        #    #   S           #
        # ## ###########     #
        #    #    S          #
        #S         ####      #
        ######################
      out: 34
    - inp: |
        ######################
        #                  G #
        #  G    G            #
        ######### ####### ####
        #     #   S         G#
        ##   ##    ###########
        #    #   S           #
        # ## ###########     #
        #    #    S          #
        #S         ####      #
        ######################
      out: 34
    - inp: |
        ######################
        #        #         G #
        #            ##      #
        #       S#############
        #      ###          G#
        #      ###           #
        #        #           #
        ## #######           #
        #   S                #
        #                    #
        #                  S #
        ######################
      out: 22
    - inp: |
        ######################
        #        #         G #
        #            ##      #
        #       S#############
        #      ###           #
        #      ###   #       #
        #        #   #       #
        ## #######   ####S   #
        #   S           #    #
        #               ##   #
        #                    #
        #    #################
        #                    #
        #                    #
        #                  S #
        ######################
      out: 55
    - inp: |
        ######################
        #  SS              G #
        #  G    G            #
        ######### ####### ####
        #     #             G#
        ##   ##    ###########
        #    #   S           #
        # ## ###########     #
        #    #    S          #
        #S         ####      #
        ######################
      out: 38
    - inp: |
        ######################
        #  SS              G #
        #  G    G            #
        ######### ####### ####
        #     #             G#
        ##   ##    ###########
        #    #   S           #
        # ## ###########     #
        #    #    S      SS  #
        #S         ####      #
        ######################
      out: 39
    - inp: |
        ############
        #SSSSSS#SSS#
        #SS#####SSS#
        #SSSS#SSSBS#
        #SSSSSSSSSS#
        ############
      out: 18
    - inp: |
        ############
        #SSSSSS#SSS#
        #SS#####SSS#
        #SSSS#SSSBS#
        #SSSSSS#SSS#
        #SS##SSSSSS#
        ############
      out: 20
    - inp: |
        ##################
        #SSSSSSSSSSSSSSSS#
        ######SSSS###SSSS#
        #SSSSSSSSS###SSSS#
        #SSS###SSSSSSSSSS#
        #SSS###SSSS#####S#
        #SS####SSSS#SSSSS#
        #SSSSSSSSSS#SSSSB#
        #SSSSSSSSSS#SSSSB#
        ##################
      out: 28
    - inp: |
        ############
        #SSSSSS#SSS#
        #SS#####SSS#
        #SSSS#SSSBS#
        #BBSSSS#SSS#
        #SS##SSSSSS#
        #SS##SSSSSS#
        ############
      out: 18
      timeout: 200
'''
)
DEFAULT_TESTSET = yaml.load(DEFAULT_TESTSET_YAML)


# Custom comparison functions

# Sokoban logic
class Sokoban(object):
    EMPTY = 0
    GOAL = 1
    WALL = 2
    KEEPER = 3
    BOX = 4
    BOX_ON_GOAL = 5
    KEEPER_ON_GOAL = 6
    char2id = {
        '.': EMPTY,
        'G': GOAL,
        'W': WALL,
        'K': KEEPER,
        'B': BOX,
        '*': BOX_ON_GOAL,
        '+': KEEPER_ON_GOAL
        }
    id2char = {v: k for k, v in char2id.items()}

    MOVES = {
        "U": (-1, 0),
        "D": (1, 0),
        "L": (0, -1),
        "R": (0, 1),
        }

    @staticmethod
    def read_map(lines):
        map = []
        for line in lines:
            map.append([Sokoban.char2id[c] for c in line.strip()])
        map = np.array(map)
        b_locs = set(zip(*(map == Sokoban.BOX_ON_GOAL).nonzero()))
        for br, bc in b_locs:
            map[br, bc] = Sokoban.GOAL
        b_locs.update(zip(*(map == Sokoban.BOX).nonzero()))
        b_locs = frozenset(b_locs)

        k_loc = tuple(zip(*(map == Sokoban.KEEPER_ON_GOAL).nonzero()))
        if k_loc:
            assert not tuple(zip(*(map == Sokoban.KEEPER).nonzero()))
            map[k_loc[0][0], k_loc[0][1]] = Sokoban.GOAL
        else:
            k_loc = zip(*(map == Sokoban.KEEPER).nonzero())
        k_loc, = k_loc

        map[map > Sokoban.WALL] = Sokoban.EMPTY
        return map, (k_loc, b_locs)

    @staticmethod
    def map_to_string(empty_map, state):
        k_loc, b_locs = state
        strings = [[Sokoban.id2char[i] for i in r] for r in empty_map]
        if empty_map[k_loc[0], k_loc[1]] == Sokoban.GOAL:
            strings[
                k_loc[0]][k_loc[1]] = Sokoban.id2char[Sokoban.KEEPER_ON_GOAL]
        else:
            strings[k_loc[0]][k_loc[1]] = Sokoban.id2char[Sokoban.KEEPER]
        for br, bc in b_locs:
            if empty_map[br, bc] == Sokoban.GOAL:
                strings[br][bc] = Sokoban.id2char[Sokoban.BOX_ON_GOAL]
            else:
                strings[br][bc] = Sokoban.id2char[Sokoban.BOX]
        return '\n'.join([''.join(r) for r in strings])

    @staticmethod
    def keeper_moves(empty_map, state, moves="UDLR"):
        k_loc, b_locs = state
        kr, kc = k_loc
        for m in moves:
            dr, dc = Sokoban.MOVES[m]
            nl = (kr + dr, kc + dc)
            n = empty_map[nl[0], nl[1]]
            if n != Sokoban.WALL:
                if nl not in b_locs:  # move to GOAL/EMPTY
                    yield m, (nl, b_locs)
                else:  # maybe move BOX
                    nbl = (nl[0] + dr, nl[1] + dc)
                    if empty_map[nbl[0], nbl[1]] <= Sokoban.GOAL:
                        nb_locs = set(b_locs)
                        nb_locs.remove(nl)
                        nb_locs.add(nbl)
                        yield m, (nl, frozenset(nb_locs))

    @staticmethod
    def moves_to_strings(empty_map, state, k_moves):
        if VERBOSE:
            print(Sokoban.map_to_string(empty_map, state))
        for m in k_moves:
            possible_moves = Sokoban.keeper_moves(empty_map, state, m)
            possible_moves = tuple(possible_moves)
            if not possible_moves:
                fail("Keeper move %s is illegal!" % (m,))
            (_, state), = possible_moves
            if VERBOSE:
                print("Keeper move %s" % (m,))
                print(Sokoban.map_to_string(empty_map, state))
        return state


def sokoban_validator(case, process_out, message=""):
    k_moves = whitespace_normalize(process_out)
    max_num_moves = int(whitespace_normalize(case['out']))

    empty_map, state = Sokoban.read_map(case['inp'].strip().split('\n'))
    state = Sokoban.moves_to_strings(
        empty_map, state, k_moves)

    g_locs = set(zip(*(empty_map == Sokoban.GOAL).nonzero()))
    solved = g_locs == state[1]
    if solved:
        if len(k_moves) > max_num_moves:
            fail("Level solved, but path is too long!")
        else:
            if VERBOSE:
                print(message + "Level solved!")
            return {'num_steps': len(k_moves)}
    else:
        fail("All moves were legal, but puzzle not solved")


# Komandos

class Maze:
    _dirs = {'U': (0, -1), 'D': (0, 1), 'R': (1, 0), 'L': (-1, 0)}

    def __init__(self, maze_str):
        self.m = []
        self.goals = set()
        self.starts = set()
        self.states = set()

        for x in maze_str.split('\n'):
            x = x.strip()
            if x:
                self.m.append(list(x))

        for y in range(len(self.m)):
            raw = self.m[y]
            for x in range(len(raw)):
                if self.m[y][x] == 'S':
                    self.start = (x, y)
                    self.starts.add((x, y))
                if self.m[y][x] == 'G':
                    self.goals.add((x, y))
                if self.m[y][x] == 'B':
                    self.start = (x, y)
                    self.starts.add((x, y))
                    self.goals.add((x, y))
                if self.m[y][x] != '#':
                    self.states.add((x, y))

    def to_str(self, s):
        lines = []
        for y, line in enumerate(self.m):
            cs = []
            for x, c in enumerate(line):
                if (x, y) in s:
                    if c in 'BG':
                        c = 'B'
                    else:
                        c = 'S'
                else:
                    if c in 'S':
                        c = ' '
                cs.append(c)
            lines.append(''.join(cs))
        return '\n'.join(lines)

    def do(self, state, action):
        dx, dy = Maze._dirs[action]
        x, y = state
        if self.m[y+dy][x+dx] != '#':
            return (x+dx, y+dy)
        else:
            return state

    def do_belief(self, states, action):
        return {self.do(s, action) for s in states}


def komandos_validator(case, process_out, message=""):
    k_moves = whitespace_normalize(process_out)
    max_num_moves = int(whitespace_normalize(case['out']))

    maze = Maze(case['inp'])

    states = maze.starts

    if VERBOSE:
        print(maze.to_str(states))

    for c in k_moves:
        states = maze.do_belief(states, c)
        if VERBOSE:
            print(maze.to_str(states))

    solved_fraction = len(states & maze.goals) / len(states)

    if solved_fraction == 1:
        if len(k_moves) > max_num_moves:
            fail(message + "Level solved, but path is too long!")
        else:
            if VERBOSE:
                print("Level solved!")
            return {'num_moves': len(k_moves)}
    else:
        fail("%sLevel solved in %f%% only!" % (
             message, solved_fraction * 100.0))


# Comparison functions

class ValidatorException(Exception):
    pass


def fail(message):
    raise ValidatorException(message)


def compare(returned, expected, message="Contents"):
    if returned != expected:
        fail('%s differ. Got: "%s", expceted: "%s"' % (
             message, returned, expected))


def whitespace_relaxed_validator(case, process_out):
    """
    Compare two strings ignoring whitespaces and trailing newlines.
    """
    ref_out = whitespace_normalize(case['out'])
    process_out = whitespace_normalize(process_out)
    return compare(process_out, ref_out, "Outputs")


def perlines_validator(case, process_out, line_compare_fun=compare):
    """
    Compare two strings line by line, ignoring whitespaces.
    """
    ref_lines = whitespace_normalize(case['out']).split('\n')
    process_lines = whitespace_normalize(process_out).split('\n')
    compare(len(process_lines), len(ref_lines), "Number of lines")
    for lnum, (proc_line, ref_line) in enumerate(
            zip(process_lines, ref_lines)):
        line_compare_fun(proc_line, ref_line, "Line %d contents" % (lnum + 1,))


# Comparison function utils
def ensure_unicode(obj):
    if sys.version_info[0] == 3:
        if isinstance(obj, str):
            return obj
        elif isinstance(obj, bytes):
            return obj.decode('utf8')
        else:
            return str(obj)
    else:
        if isinstance(obj, unicode):
            return obj
        elif isinstance(obj, str):
            return obj.decode('utf8')
        else:
            return unicode(obj)
    return obj


def whitespace_normalize(obj):
    """
    Optionally convert to string and normalize newline and space characters.
    """
    string = ensure_unicode(obj)
    lines = string.replace('\r', '').strip().split('\n')
    lines = [' '.join(l.strip().split()) for l in lines]
    return '\n'.join(lines)


# Subprocess handling utils
try:  # py3
    from shlex import quote as shellquote
except ImportError:  # py2
    from pipes import quote as shellquote


if os.name == 'nt':
    def shellquote(arg):
        return subprocess.list2cmdline([arg])

    def kill_proc(process):
        if process.poll() is None:
            print('Killing subprocess.')
            subprocess.call(['taskkill', '/F', '/T', '/PID', str(process.pid)])
else:
    def kill_proc(process):
        if process.poll() is None:
            print('Killing subprocess.')
            os.killpg(os.getpgid(process.pid), signal.SIGTERM)


def run_and_score_case(program, defaults, case_def, validator, timeout_multiplier):
    opts = dict(defaults)
    opts.update(case_def)
    opts['timeout'] *= timeout_multiplier
    process_out, elapsed_time = run_case(program, **opts)
    if VERBOSE:
        print("Got output:")
        print(process_out)
    measurements = validator(opts, process_out)
    measurements = measurements or {}
    measurements['time'] = elapsed_time
    return measurements


def run_case(program, inp, out=None,
             input_file='<stdin>', output_file='<stdout>',
             timeout=1.0):
    del out  # unused
    inp = ensure_unicode(inp)
    if inp[-1] != '\n':
        inp += '\n'
    inp = inp.encode('utf8')

    if input_file != '<stdin>':
        with open(input_file, 'wb') as in_f:
            in_f.write(inp)
        inp = None
    try:
        if output_file != '<stdout>':
            os.remove(output_file)
    except:
        pass

    stdin = subprocess.PIPE if input_file == '<stdin>' else None
    stdout = subprocess.PIPE if output_file == '<stdout>' else None
    process_out = ''
    process = None

    try:
        if os.name == 'nt':
            kwargs = {}
        else:
            kwargs = {'preexec_fn': os.setpgrp}

        process = subprocess.Popen(
            program, shell=True, stdin=stdin, stdout=stdout, **kwargs)
        start = time.time()
        if timeout > 0:
            timer = threading.Timer(timeout, kill_proc, [process])
            timer.start()

        process_out, _ = process.communicate(inp)
        elapsed = time.time() - start
    except Exception as e:
        fail(str(e))
    finally:
        if process:
            kill_proc(process)
        if timeout > 0:
            timer.cancel()
    if process.poll() != 0:
        fail("Bad process exit status: %d" % (process.poll(),))

    if output_file != '<stdout>':
        if not os.path.isfile(output_file):
            fail("Output file %s does not exist" % (output_file, ))
        with open(output_file, 'rb') as out_f:
            process_out = out_f.read()
    process_out = process_out.decode('utf8')

    return process_out, elapsed


def ensure_newline_string(obj):
    obj = ensure_unicode(obj)
    if obj[-1] != '\n':
        obj += '\n'
    return obj


def show_example(defaults, case_def):
    opts = dict(defaults)
    opts.update(case_def)
    print("Input is passed using %s and contains:" % (opts['input_file'],))
    print(ensure_newline_string(opts["inp"]))
    print("Output is expected in %s with contents:" % (opts['output_file'],))
    print(ensure_newline_string(opts["out"]))


def get_argparser():
    parser = argparse.ArgumentParser()
    parser.add_argument(
        '--cases', default='',
        help='Comma-separated list of test cases to run, e.g. 1,2,3-6.')
    parser.add_argument(
        '--testset', default='',
        help='Path to a YAML test set definition.')
    parser.add_argument(
        '--show_example', default=False, action='store_true',
        help='Print a sample input/output pair.')
    parser.add_argument(
        '--timeout-multiplier', '-tm',
        help='Multiply timeout by provided amount, e.g. 2.13')
    parser.add_argument(
        '--verbose', default=False, action='store_true',
        help='Print more information about solutions.')
    parser.add_argument(
        '--stdio', default=False, action='store_true',
        help='Use stdin/stdout for communication.')
    parser.add_argument(
        'problem',
        help='Problem form this homework, one of: %s.' %
        (', '.join(sorted(DEFAULT_TESTSET.keys())),))
    parser.add_argument(
        'program', nargs=argparse.REMAINDER,
        help='Program to execute, e.g. python solution.py.')
    return parser


def get_program(args):
    return ' '.join([shellquote(a) for a in args])


def get_cases(problem_def, cases):
    problem_cases = problem_def['cases']
    if cases == '':
        for case in enumerate(problem_cases, 1):
            yield case
        return
    cases = cases.strip().split(',')
    for case in cases:
        if '-' not in case:
            case = int(case) - 1
            if case < 0:
                raise Exception('Bad case number: %d' % (case + 1,))
            yield case + 1, problem_cases[case]
        else:
            low, high = case.split('-')
            low = int(low) - 1
            high = int(high)
            if low < 0 or high > len(problem_cases):
                raise Exception('Bad case range: %s' % (case,))
            for case in range(low, high):
                yield case + 1, problem_cases[case]


def simple_benchmark():
    product = 1.0
    for counter in range(1, 1000, 1):
        for dex in list(range(1, 360, 1)):
            angle = math.radians(dex)
            product *= math.sin(angle)**2 + math.cos(angle)**2

    sys.stdout.write('.')
    sys.stdout.flush()
    return product


def start_benchmark():
        print('Executing CPU benchmark. It may take some time ...')
        print('0%', '.'*96, '100%')
        sys.stdout.write('|')
        sys.stdout.flush()

        result = timeit.repeat('validator.simple_benchmark()', setup='import validator', number=10, repeat=10)
        result = list(sorted(result))
        result = sum(result[:3])/3.0
        return (result - 1.0) / 1.5 + 1.0  # some tweaks


if __name__ == '__main__':
    benchmark_file = '.benchmark_result'
    benchmark_result = 1.0
    if not os.path.isfile(benchmark_file):
        benchmark_result = start_benchmark()
        print('|\nResult = ', benchmark_result)
        with open(benchmark_file, 'w') as outFile:
            outFile.write(str(benchmark_result))
    else:
        with open(benchmark_file) as inputFile:
            benchmark_result = float(inputFile.readline())

    parser = get_argparser()
    args = parser.parse_args()
    VERBOSE = args.verbose

    if args.testset:
        with open(args.testset) as testset_f:
            testset = yaml.load(testset_f)
    else:
        testset = DEFAULT_TESTSET
    if args.problem not in testset:
        print('Problem not known: %s. Choose one of %s.' %
              (args.problem, ', '.join(sorted(testset.keys()))))

    problem_def = testset[args.problem]
    problem_validator = eval(problem_def['validator'])
    problem_cases = get_cases(problem_def, args.cases)
    program = get_program(args.program)

    if args.show_example:
        show_example(problem_def['defaults'], next(problem_cases)[1])
        sys.exit()

    failed_cases = []
    ok_cases = []
    for case_num, case_def in problem_cases:
        print('Running case %d... ' % (case_num,), end='')
        try:
            timeout_multiplier = float(args.timeout_multiplier) if args.timeout_multiplier and float(args.timeout_multiplier) > 1 else 1
            if args.stdio:
                case_def['input_file'] = '<stdin>'
                case_def['output_file'] = '<stdout>'
            case_meas = run_and_score_case(
                program, problem_def['defaults'], case_def, problem_validator, timeout_multiplier*benchmark_result)
            ok_cases.append((case_num, case_meas))
            print('OK!')
        except ValidatorException as e:
            failed_cases.append(case_num)
            print('Failed:')
            print(str(e))

    print('\nValidation result: %d/%d cases pass.\n' % (
        len(ok_cases), len(ok_cases) + len(failed_cases)))

    tot_meas = {}
    for nc, meas in ok_cases:
        for k, v in meas.items():
            tot_meas[k] = tot_meas.get(k, 0) + v
    for k, v in tot_meas.items():
        print("For passing cases total %s: %s" % (k, v))

    if failed_cases:
        print('\nSome test cases have failed. '
              'To rerun the failing cases execute:')
        misc_opts = ''
        if args.verbose:
            misc_opts = ' --verbose'
        if args.timeout_multiplier:
            misc_opts += ' --timeout-multiplier ' + args.timeout_multiplier
        if args.testset:
            misc_opts = '%s --testset %s' % (
                misc_opts, shellquote(args.testset),)
        cases_opt = '--cases ' + ','.join([str(fc) for fc in failed_cases])
        print('python validator.py%s %s %s %s' %
              (misc_opts, cases_opt, args.problem, program))

